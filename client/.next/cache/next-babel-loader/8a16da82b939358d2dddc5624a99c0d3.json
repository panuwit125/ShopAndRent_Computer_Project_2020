{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\n\nvar _jsxFileName = \"D:\\\\GitHub\\\\covid-web\\\\pages\\\\page.covidquestion.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport { LeftOutlined, RightOutlined } from \"@ant-design/icons\";\nimport Router from \"next/router\";\nimport React, { useState, useEffect } from \"react\";\nimport HeaderCovid from \"./components/component.headercovid\";\nimport QuestionCovid from \"./components/component.question\";\nimport styled, { keyframes } from \"styled-components\";\nimport { useSelector } from \"react-redux\";\nimport img1 from \"../public/9.png\";\nimport Axios from \"axios\";\nimport AudioPlayer from \"./components/component.audioplayer\";\nimport Duration from \"./components/component.duration\";\nimport Speechtotext from \"./components/component.speechtotext\";\nimport Copyright from \"./components/component.footercopyright\";\nimport ButtonQuestion from \"./components/component.buttonquestion\";\nvar Array = [];\nvar FormItem = _Form.Item;\n\nfunction CovidQuestion() {\n  _s();\n\n  var _this = this;\n\n  //State จัดการเรื่องชุดคำถาม =========================\n  var _useState = useState([]),\n      page = _useState[0],\n      setPage = _useState[1];\n\n  var _useState2 = useState(0),\n      currentQuestion = _useState2[0],\n      setCurrentQuestion = _useState2[1];\n\n  var _useState3 = useState(false),\n      isEnd = _useState3[0],\n      setisEnd = _useState3[1];\n\n  var _useState4 = useState(false),\n      isLoading = _useState4[0],\n      setisLoading = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      options = _useState5[0],\n      setoptions = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      question = _useState6[0],\n      setQuestion = _useState6[1];\n\n  var _useState7 = useState(false),\n      token = _useState7[0],\n      settoken = _useState7[1];\n\n  var _useState8 = useState([]),\n      keyword = _useState8[0],\n      setKeyword = _useState8[1];\n\n  var _useSelector = useSelector(function (state) {\n    return state.post;\n  }),\n      time = _useSelector.time; //จัดการชุดคำตอบที่จะส่งไปตอนเสร็จ\n\n\n  var _useState9 = useState(null),\n      questionID = _useState9[0],\n      setQuestionID = _useState9[1];\n\n  var _useState10 = useState(false),\n      CheckSuccess = _useState10[0],\n      setCheckSuccess = _useState10[1]; //=================================================\n  //-----------------------------------------\n\n\n  useEffect(function () {\n    if (!isLoading) {\n      Axios({\n        method: \"post\",\n        url: \"https://www.nuscreening.kasemsanm.com/api/v1/query/question\",\n        headers: {\n          Authorization: \"Bearer \".concat(localStorage.getItem(\"jwt\"))\n        },\n        data: {\n          patient_no: \"3640600077526\",\n          form_question_id: 1\n        }\n      }).then(function (res) {\n        console.log(\"Import Data Success!\", res);\n        setPage(res.data.payload);\n        settoken(true);\n      })[\"catch\"](function (error) {\n        console.log(\"Not found Token or PatientNo\", error.response.status);\n\n        if (error.response.status === 401) {\n          Axios({\n            method: \"GET\",\n            url: \"https://www.nuscreening.kasemsanm.com/api/v1/manage/token\",\n            headers: {\n              Authorization: \"Bearer \".concat(localStorage.getItem(\"jwt-refresh\"))\n            }\n          }).then(function (res) {\n            localStorage.setItem(\"jwt\", res.data[\"accessToken\"]);\n            localStorage.setItem(\"jwt-refresh\", res.data[\"refreshToken\"]);\n            console.log(\"Update Token Success!\");\n          })[\"catch\"](function (error) {\n            console.log(\"Error Code\", error.response.status);\n            Router.push(\"/page.covid1\");\n          });\n        }\n\n        if (error.response.status === 404) {\n          console.log(\"ไม่มีข้อมูลอยู่ในระบบ\");\n          Router.push(\"/page.covid2\");\n        }\n      });\n    }\n  }, []);\n  useEffect(function () {\n    if (token) {\n      console.log(\"Function Set Question Two!\", page.length, currentQuestion);\n\n      if (Array.length >= page.length) {\n        for (var i = 0; i <= Array.length - 1; i++) {\n          if (Array[i] === undefined) {\n            console.log(\"break\", Array[i], Array.length, i);\n            break;\n          }\n\n          if (i === Array.length - 1) {\n            console.log(\"Suc\");\n            setisEnd(true);\n          }\n\n          console.log(\"err\", i, Array.length);\n        }\n\n        console.log(\"หลุดลูป\");\n      }\n\n      if (page.length - 1 >= currentQuestion >= 0) {\n        console.log(\"CurrentQuestion\", currentQuestion);\n        console.log(\"sadasf\");\n        setQuestion(page[currentQuestion].body);\n        setoptions(page[currentQuestion].voice);\n        setQuestionID(page[currentQuestion].question_id);\n        setKeyword(page[currentQuestion].keywords);\n        settoken(false);\n        setisLoading(true);\n      }\n    }\n  }, [token, currentQuestion]);\n\n  var nextQuestionHandler = function nextQuestionHandler(answer, raw_answer) {\n    Array[currentQuestion] = {\n      question_id: questionID,\n      answer: answer,\n      rew_answer: raw_answer\n    };\n\n    if (currentQuestion + 1 >= page.length) {\n      console.log(\"Final1111\", currentQuestion + 1);\n      setCurrentQuestion(currentQuestion);\n      settoken(true);\n    } else {\n      setCurrentQuestion(currentQuestion + 1);\n      settoken(true);\n      console.log(\"Final3333\", currentQuestion + 1);\n    }\n\n    console.log(\"Question\", currentQuestion);\n    console.log(\"Array\", Array); //}\n  };\n\n  var saveDataHandler = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var payload;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              payload = {\n                patient_no: 3640600077525,\n                form_questions_id: 1,\n                form_questions: Array\n              };\n              console.log(payload);\n              setCheckSuccess(true);\n              _context.next = 5;\n              return Axios({\n                method: \"post\",\n                url: \"https://www.nuscreening.kasemsanm.com/api/v1/query/sendQuestion\",\n                headers: {\n                  Authorization: \"Bearer \".concat(localStorage.getItem(\"jwt\"))\n                },\n                data: payload\n              }).then(function (res) {\n                console.log(\"Success to Save Data!\", res);\n                console.log(\"เตรียม\", Array);\n                var checknextform = res.data.form_question_name;\n\n                if (checknextform === null) {\n                  Router.push(\"/page.covidcomplete\");\n                } else {\n                  Array = [];\n                  console.log(Array);\n                  console.log(\"restart\", res.data);\n                  setisEnd(false);\n                  setPage(res.data.payload);\n                  setCurrentQuestion(0);\n                  settoken(true);\n                  setCheckSuccess(false);\n                }\n              })[\"catch\"](function (error) {\n                console.log(\"Not found Token or PatientNo\", error);\n\n                if (error.response.status === 401) {\n                  Axios({\n                    method: \"GET\",\n                    url: \"https://www.nuscreening.kasemsanm.com/api/v1/manage/token\",\n                    headers: {\n                      Authorization: \"Bearer \".concat(localStorage.getItem(\"jwt-refresh\"))\n                    }\n                  }).then(function (res) {\n                    localStorage.setItem(\"jwt\", res.data[\"accessToken\"]);\n                    localStorage.setItem(\"jwt-refresh\", res.data[\"refreshToken\"]);\n                    console.log(\"Update Token Success!\");\n                    setisLoading(false);\n                  })[\"catch\"](function (error) {\n                    console.log(\"Error Code\", error.response.status);\n                    Router.push(\"/page.covid1\");\n                  });\n                }\n\n                if (error.response.status === 404) {\n                  console.log(\"ไม่มีข้อมูลอยู่ในระบบ\");\n                  Router.push(\"/page.covid2\");\n                }\n              });\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function saveDataHandler() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var ButtonNext = function ButtonNext(condition) {\n    if (\"next\" === condition) {\n      if (currentQuestion + 1 >= page.length) {\n        console.log(\"Final Question\", currentQuestion, page.length);\n        setCurrentQuestion(currentQuestion);\n        settoken(true);\n      } else {\n        console.log(\"Simple Question\", currentQuestion, page.length);\n        setCurrentQuestion(currentQuestion + 1);\n        settoken(true);\n      }\n    } else if (\"back\" === condition) {\n      if (currentQuestion === 0) {\n        console.log(\"First Question\", currentQuestion, page.length);\n        setCurrentQuestion(currentQuestion);\n        settoken(true);\n      } else {\n        console.log(\"Simple Question\", currentQuestion, page.length);\n        setCurrentQuestion(currentQuestion - 1);\n        settoken(true);\n      }\n    }\n  };\n\n  var Showbar = function Showbar() {\n    return __jsx(\"div\", {\n      className: \"w3-light-grey\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 7\n      }\n    }, __jsx(\"div\", {\n      className: \"nu-boxbar-covidqt\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 9\n      }\n    }));\n  }; //====================================================\n\n\n  if (isLoading) {\n    console.log('aaaaabbbb');\n\n    if (isEnd) {\n      if (!CheckSuccess) {\n        saveDataHandler();\n      }\n\n      return null;\n    } else {\n      console.log('aaaaa');\n      return null;\n    }\n  } else {\n    return null;\n  }\n}\n\n_s(CovidQuestion, \"5+DfoXZa7zLeow6K0lRnwg934SY=\", false, function () {\n  return [useSelector];\n});\n\n_c = CovidQuestion;\nexport default CovidQuestion;\n\nvar _c;\n\n$RefreshReg$(_c, \"CovidQuestion\");","map":{"version":3,"sources":["D:/GitHub/covid-web/pages/page.covidquestion.js"],"names":["LeftOutlined","RightOutlined","Router","React","useState","useEffect","HeaderCovid","QuestionCovid","styled","keyframes","useSelector","img1","Axios","AudioPlayer","Duration","Speechtotext","Copyright","ButtonQuestion","Array","FormItem","Item","CovidQuestion","page","setPage","currentQuestion","setCurrentQuestion","isEnd","setisEnd","isLoading","setisLoading","options","setoptions","question","setQuestion","token","settoken","keyword","setKeyword","state","post","time","questionID","setQuestionID","CheckSuccess","setCheckSuccess","method","url","headers","Authorization","localStorage","getItem","data","patient_no","form_question_id","then","res","console","log","payload","error","response","status","setItem","push","length","i","undefined","body","voice","question_id","keywords","nextQuestionHandler","answer","raw_answer","rew_answer","saveDataHandler","form_questions_id","form_questions","checknextform","form_question_name","ButtonNext","condition","Showbar"],"mappings":"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","sourcesContent":["import { Form, Button } from \"antd\";\r\nimport { LeftOutlined, RightOutlined } from \"@ant-design/icons\";\r\nimport Router from \"next/router\";\r\nimport React, { useState, useEffect } from \"react\";\r\nimport HeaderCovid from \"./components/component.headercovid\";\r\nimport QuestionCovid from \"./components/component.question\";\r\nimport styled, { keyframes } from \"styled-components\";\r\nimport { useSelector } from \"react-redux\";\r\nimport img1 from \"../public/9.png\";\r\nimport Axios from \"axios\";\r\nimport AudioPlayer from \"./components/component.audioplayer\";\r\nimport Duration from \"./components/component.duration\";\r\nimport Speechtotext from \"./components/component.speechtotext\";\r\nimport Copyright from \"./components/component.footercopyright\";\r\nimport ButtonQuestion from \"./components/component.buttonquestion\";\r\n\r\nvar Array = [];\r\nconst FormItem = Form.Item;\r\nfunction CovidQuestion() {\r\n  //State จัดการเรื่องชุดคำถาม =========================\r\n  const [page, setPage] = useState([]);\r\n  const [currentQuestion, setCurrentQuestion] = useState(0);\r\n  const [isEnd, setisEnd] = useState(false);\r\n  const [isLoading, setisLoading] = useState(false);\r\n  const [options, setoptions] = useState(\"\");\r\n  const [question, setQuestion] = useState(\"\");\r\n  const [token, settoken] = useState(false);\r\n  const [keyword, setKeyword] = useState([]);\r\n  const { time } = useSelector((state) => state.post);\r\n\r\n  //จัดการชุดคำตอบที่จะส่งไปตอนเสร็จ\r\n  const [questionID, setQuestionID] = useState(null);\r\n  const [CheckSuccess, setCheckSuccess] = useState(false);\r\n  //=================================================\r\n\r\n  //-----------------------------------------\r\n  useEffect(() => {\r\n    if (!isLoading) {\r\n      Axios({\r\n        method: \"post\",\r\n        url: \"https://www.nuscreening.kasemsanm.com/api/v1/query/question\",\r\n        headers: { Authorization: `Bearer ${localStorage.getItem(\"jwt\")}` },\r\n        data: { patient_no: \"3640600077526\", form_question_id: 1 },\r\n      })\r\n        .then((res) => {\r\n          console.log(\"Import Data Success!\", res);\r\n          setPage(res.data.payload);\r\n          settoken(true);\r\n        })\r\n        .catch((error) => {\r\n          console.log(\"Not found Token or PatientNo\", error.response.status);\r\n          if (error.response.status === 401) {\r\n            Axios({\r\n              method: \"GET\",\r\n              url: \"https://www.nuscreening.kasemsanm.com/api/v1/manage/token\",\r\n              headers: {\r\n                Authorization: `Bearer ${localStorage.getItem(\"jwt-refresh\")}`,\r\n              },\r\n            })\r\n              .then((res) => {\r\n                localStorage.setItem(\"jwt\", res.data[\"accessToken\"]);\r\n                localStorage.setItem(\"jwt-refresh\", res.data[\"refreshToken\"]);\r\n                console.log(\"Update Token Success!\");\r\n              })\r\n              .catch((error) => {\r\n                console.log(\"Error Code\", error.response.status);\r\n                Router.push(\"/page.covid1\");\r\n              });\r\n          }\r\n          if (error.response.status === 404) {\r\n            console.log(\"ไม่มีข้อมูลอยู่ในระบบ\");\r\n            Router.push(\"/page.covid2\");\r\n          }\r\n        });\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (token) {\r\n      console.log(\"Function Set Question Two!\", page.length, currentQuestion);\r\n      if (Array.length >= page.length) {\r\n        for (var i = 0; i <= Array.length - 1; i++) {\r\n          if (Array[i] === undefined) {\r\n            console.log(\"break\", Array[i], Array.length, i);\r\n            break;\r\n          }\r\n          if (i === Array.length - 1) {\r\n            console.log(\"Suc\");\r\n            setisEnd(true);\r\n          }\r\n          console.log(\"err\", i, Array.length);\r\n        }\r\n        console.log(\"หลุดลูป\");\r\n      }\r\n      if (page.length - 1 >= currentQuestion >= 0) {\r\n        console.log(\"CurrentQuestion\", currentQuestion);\r\n        console.log(\"sadasf\");\r\n        setQuestion(page[currentQuestion].body);\r\n        setoptions(page[currentQuestion].voice);\r\n        setQuestionID(page[currentQuestion].question_id);\r\n        setKeyword(page[currentQuestion].keywords);\r\n        settoken(false);\r\n        setisLoading(true);\r\n      }\r\n    }\r\n  }, [token, currentQuestion]);\r\n\r\n  const nextQuestionHandler =(answer, raw_answer) => {\r\n    Array[currentQuestion] = {\r\n      question_id: questionID,\r\n      answer: answer,\r\n      rew_answer: raw_answer,\r\n    };\r\n    if (currentQuestion + 1 >= page.length) {\r\n      console.log(\"Final1111\", currentQuestion + 1);\r\n      setCurrentQuestion(currentQuestion);\r\n      settoken(true);\r\n    } else {\r\n      setCurrentQuestion(currentQuestion + 1);\r\n      settoken(true);\r\n      console.log(\"Final3333\", currentQuestion + 1);\r\n    }\r\n    console.log(\"Question\", currentQuestion);\r\n    console.log(\"Array\", Array);\r\n\r\n    //}\r\n  };\r\n\r\n  const saveDataHandler = async () => {\r\n    let payload = {\r\n      patient_no: 3640600077525,\r\n      form_questions_id: 1,\r\n      form_questions: Array,\r\n    };\r\n    console.log(payload);\r\n    setCheckSuccess(true);\r\n    await Axios({\r\n      method: \"post\",\r\n      url: \"https://www.nuscreening.kasemsanm.com/api/v1/query/sendQuestion\",\r\n      headers: { Authorization: `Bearer ${localStorage.getItem(\"jwt\")}` },\r\n      data: payload,\r\n    })\r\n      .then(function (res) {\r\n        console.log(\"Success to Save Data!\", res);\r\n        console.log(\"เตรียม\", Array);\r\n        const checknextform = res.data.form_question_name;\r\n        if (checknextform === null) {\r\n          Router.push(\"/page.covidcomplete\");\r\n        } else {\r\n          Array = [];\r\n          console.log(Array);\r\n          console.log(\"restart\", res.data);\r\n          setisEnd(false);\r\n          setPage(res.data.payload);\r\n          setCurrentQuestion(0);\r\n          settoken(true);\r\n          setCheckSuccess(false);\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        console.log(\"Not found Token or PatientNo\", error);\r\n        if (error.response.status === 401) {\r\n          Axios({\r\n            method: \"GET\",\r\n            url: \"https://www.nuscreening.kasemsanm.com/api/v1/manage/token\",\r\n            headers: {\r\n              Authorization: `Bearer ${localStorage.getItem(\"jwt-refresh\")}`,\r\n            },\r\n          })\r\n            .then((res) => {\r\n              localStorage.setItem(\"jwt\", res.data[\"accessToken\"]);\r\n              localStorage.setItem(\"jwt-refresh\", res.data[\"refreshToken\"]);\r\n              console.log(\"Update Token Success!\");\r\n              setisLoading(false);\r\n            })\r\n            .catch((error) => {\r\n              console.log(\"Error Code\", error.response.status);\r\n              Router.push(\"/page.covid1\");\r\n            });\r\n        }\r\n        if (error.response.status === 404) {\r\n          console.log(\"ไม่มีข้อมูลอยู่ในระบบ\");\r\n          Router.push(\"/page.covid2\");\r\n        }\r\n      });\r\n  };\r\n\r\n  const ButtonNext = (condition) => {\r\n    if (\"next\" === condition) {\r\n      if (currentQuestion + 1 >= page.length) {\r\n        console.log(\"Final Question\", currentQuestion, page.length);\r\n        setCurrentQuestion(currentQuestion);\r\n        settoken(true);\r\n      } else {\r\n        console.log(\"Simple Question\", currentQuestion, page.length);\r\n        setCurrentQuestion(currentQuestion + 1);\r\n        settoken(true);\r\n      }\r\n    } else if (\"back\" === condition) {\r\n      if (currentQuestion === 0) {\r\n        console.log(\"First Question\", currentQuestion, page.length);\r\n        setCurrentQuestion(currentQuestion);\r\n        settoken(true);\r\n      } else {\r\n        console.log(\"Simple Question\", currentQuestion, page.length);\r\n        setCurrentQuestion(currentQuestion - 1);\r\n        settoken(true);\r\n      }\r\n    }\r\n  };\r\n\r\n  const Showbar = () => {\r\n    return (\r\n      <div className=\"w3-light-grey\">\r\n        <div className=\"nu-boxbar-covidqt\" />\r\n      </div>\r\n    );\r\n  };\r\n\r\n  //====================================================\r\n  if (isLoading) {\r\n    console.log('aaaaabbbb')\r\n    if (isEnd) {\r\n      if (!CheckSuccess) {\r\n        saveDataHandler();\r\n      }\r\n      return null;\r\n    } else {\r\n      console.log('aaaaa')\r\n      return (\r\n        null\r\n      );\r\n    }\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport default CovidQuestion;\r\n"]},"metadata":{},"sourceType":"module"}