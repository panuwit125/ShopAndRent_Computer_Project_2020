{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nvar __jsx = React.createElement;\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    color: #fff !important;\\n    background-color: #ec6900 !important;\\n    height: 5px;\\n    width: 100%;\\n    animation: \", \" \", \"s linear;\\n  \"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    from {\\n      width: 0%;\\n    }\\n  \\n    to {\\n      width: 100%;\\n    }\\n  \"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport Router from \"next/router\";\nimport React, { useState, useEffect } from \"react\";\nimport HeaderCovid from \"./components/component.headercovid\";\nimport QuestionCovid from \"./components/component.question\";\nimport styled, { keyframes } from \"styled-components\";\nimport { useSelector } from \"react-redux\";\nimport img1 from \"../public/9.png\";\nimport Axios from \"axios\";\nimport AudioPlayer from \"./components/component.audioplayer\";\nimport Duration from \"./components/component.duration\";\nimport Speechtotext from \"./components/component.speechtotext\";\nimport Copyright from \"./components/component.footercopyright\";\nimport ButtonQuestion from \"./components/component.buttonquestion\";\nvar FormItem = _Form.Item;\n\nfunction CovidQuestion(props) {\n  //State จัดการ Button\n  var _useState = useState(false),\n      showResults = _useState[0],\n      setShowResults = _useState[1]; //State จัดการเรื่องชุดคำถาม =========================\n\n\n  var _useState2 = useState([]),\n      page = _useState2[0],\n      setPage = _useState2[1];\n\n  var _useState3 = useState(0),\n      currentQuestion = _useState3[0],\n      setCurrentQuestion = _useState3[1];\n\n  var _useState4 = useState(0),\n      score = _useState4[0],\n      setscore = _useState4[1];\n\n  var _useState5 = useState(true),\n      disabled = _useState5[0],\n      setdisabled = _useState5[1];\n\n  var _useState6 = useState(false),\n      isEnd = _useState6[0],\n      setisEnd = _useState6[1];\n\n  var _useState7 = useState(false),\n      isLoading = _useState7[0],\n      setisLoading = _useState7[1];\n\n  var _useState8 = useState(\"\"),\n      options = _useState8[0],\n      setoptions = _useState8[1];\n\n  var _useState9 = useState(\"\"),\n      question = _useState9[0],\n      setQuestion = _useState9[1];\n\n  var _useState10 = useState(20),\n      timer = _useState10[0],\n      setTimer = _useState10[1];\n\n  var _useState11 = useState(false),\n      token = _useState11[0],\n      settoken = _useState11[1];\n\n  var _useState12 = useState([]),\n      keyword = _useState12[0],\n      setKeyword = _useState12[1];\n\n  var _useSelector = useSelector(function (state) {\n    return state.post;\n  }),\n      Name = _useSelector.Name,\n      SSID = _useSelector.SSID,\n      PostId = _useSelector.PostId,\n      BirdDay = _useSelector.BirdDay,\n      time = _useSelector.time; //จัดการชุดคำตอบที่จะส่งไปตอนเสร็จ\n\n\n  var _useState13 = useState([]),\n      questionNo = _useState13[0],\n      setQuestionNo = _useState13[1];\n\n  var _useState14 = useState([]),\n      answerQuestion = _useState14[0],\n      setAnswerQuestion = _useState14[1];\n\n  var _useState15 = useState(null),\n      questionID = _useState15[0],\n      setQuestionID = _useState15[1];\n\n  var _useState16 = useState(false),\n      CheckSuccess = _useState16[0],\n      setCheckSuccess = _useState16[1];\n\n  var _useState17 = useState(0),\n      numberQuestion = _useState17[0],\n      setNumberQuestion = _useState17[1];\n\n  var number = new Array(numberQuestion); //=================================================\n  //style component ของ Progress-------------\n\n  var rotate = keyframes(_templateObject());\n  var Box = styled.div(_templateObject2(), rotate, timer); //-----------------------------------------\n\n  useEffect(function () {\n    if (!isLoading) {\n      Axios({\n        method: \"post\",\n        url: \"http://34.87.54.114:8003/api/v1/query/question\",\n        headers: {\n          Authorization: \"Bearer \".concat(localStorage.getItem(\"jwt\"))\n        },\n        data: {\n          patient_no: \"3640600077526\",\n          form_question_id: 1\n        }\n      }).then(function (res) {\n        setPage(res.data.payload);\n        setNumberQuestion(page.length); //setisLoading(true);\n\n        settoken(true);\n        console.log(\"Import Data Success!\", res);\n      })[\"catch\"](function (error) {\n        console.log(\"Not found Token or PatientNo\", error.response.status);\n\n        if (error.response.status === 401) {\n          Axios({\n            method: \"GET\",\n            url: \"http://34.87.54.114:8003/api/v1/manage/token\",\n            headers: {\n              Authorization: \"Bearer \".concat(localStorage.getItem(\"jwt-refresh\"))\n            }\n          }).then(function (res) {\n            localStorage.setItem(\"jwt\", res.data[\"accept-token\"]);\n            console.log(\"Update Token Success!\");\n            setisLoading(false);\n          })[\"catch\"](function (error) {\n            console.log(\"Error Code\", error.response.status);\n            Router.push(\"/page.covid1\");\n          });\n        }\n\n        if (error.response.status === 404) {\n          console.log(\"ไม่มีข้อมูลอยู่ในระบบ\");\n          Router.push(\"/page.covid2\");\n        }\n      });\n    }\n  }, []);\n  useEffect(function () {\n    if (token) {\n      console.log(\"สถานะการโหลดข้อมูล\", token);\n      console.log(\"isLoading =\", isLoading);\n      console.log(\"คำถามที่เท่าไร\", currentQuestion + 1);\n      console.log(\"คำถามทั้งหมด\", page);\n      settoken(false);\n      loadQuizData();\n    }\n\n    if (currentQuestion > 0) {\n      console.log(\"สถานะของ Token =\", token);\n      console.log(\"คำถามข้อปัจจุบัน\", page[currentQuestion]);\n      console.log(\"คำถามที่เท่าไร\", currentQuestion + 1);\n\n      if (currentQuestion !== currentQuestion - 1) {\n        setQuestion(page[currentQuestion].body);\n        setoptions(page[currentQuestion].voice);\n        setQuestionID(page[currentQuestion].questions_id);\n        setKeyword(page[currentQuestion].keywords);\n        setTimer(52);\n        console.log(\"QuestionID\", questionID);\n      }\n    }\n\n    if (!disabled) {\n      setdisabled(true);\n    } //setTimeout(()=>{alert('หมดเวลา');},timer*1000);\n\n  }, [token, currentQuestion]); //Function การจัดการคำถาม==============================\n\n  var loadQuizData = function loadQuizData() {\n    setdisabled(false);\n    setQuestion(page[currentQuestion].body);\n    setoptions(page[currentQuestion].voice);\n    setQuestionID(page[currentQuestion].questions_id);\n    setKeyword(page[currentQuestion].keywords);\n    setisLoading(true);\n    setShowResults(true);\n    console.log(\"Page have\", page);\n    console.log(\"QuestionID\", questionID);\n  };\n\n  var nextQuestionHandler = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(answer, raw_answer) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (currentQuestion === page.length - 1) {\n                finishHandler(answer, raw_answer);\n              } else {\n                if (answer === true) {\n                  setscore(score + 1);\n                } else {\n                  setscore(score);\n                }\n\n                setQuestionNo([].concat(_toConsumableArray(questionNo), [{\n                  question_id: questionID,\n                  answer: answer,\n                  rew_answer: raw_answer\n                }]));\n                setCurrentQuestion(currentQuestion + 1);\n                console.log(\"Question\", currentQuestion, questionNo);\n              }\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function nextQuestionHandler(_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var finishHandler = function finishHandler(answer, raw_answer) {\n    setAnswerQuestion([].concat(_toConsumableArray(answerQuestion), [answer]));\n    setQuestionNo([].concat(_toConsumableArray(questionNo), [{\n      question_id: questionID,\n      answer: answer,\n      rew_answer: raw_answer\n    }]));\n\n    if (answer === \"yes\") {\n      setscore(score + 1);\n    }\n\n    if (currentQuestion === page.length - 1) {\n      setisEnd(true);\n    }\n  };\n\n  var saveDataHandler = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setCheckSuccess(true);\n              console.log(\"เตรียม\", questionNo);\n              _context2.next = 4;\n              return Axios({\n                method: \"post\",\n                url: \"http://34.87.54.114:8003/api/v1/query/sendQuestion\",\n                headers: {\n                  Authorization: \"Bearer \".concat(localStorage.getItem(\"jwt\"))\n                },\n                data: {\n                  /*patient_no: SSID,\r\n                  form_question_id: 1,\r\n                  form_question: questionNo*/\n                  patient_no: 1103702303712,\n                  form_questions_id: 2,\n                  form_questions: [{\n                    question_id: 4,\n                    answer: true,\n                    rew_answer: \"ไม่มีอาการ\"\n                  }, {\n                    question_id: 5,\n                    answer: true,\n                    rew_answer: \"ไม่มีอาการ\"\n                  }, {\n                    question_id: 6,\n                    answer: true,\n                    rew_answer: \"ไม่มีอาการ\"\n                  }, {\n                    question_id: 7,\n                    answer: true,\n                    rew_answer: \"ไม่มีอาการ\"\n                  }]\n                }\n              }).then(function (res) {\n                console.log(\"Success to Save Data!\", res);\n                console.log(\"เตรียม\", questionNo);\n                Router.push(\"/page.covidcomplete\");\n              })[\"catch\"](function (error) {\n                console.log(\"Not found Token or PatientNo\", error.response.status);\n\n                if (error.response.status === 401) {\n                  Axios({\n                    method: \"GET\",\n                    url: \"http://34.87.54.114:8003/api/v1/manage/token\",\n                    headers: {\n                      Authorization: \"Bearer \".concat(localStorage.getItem(\"jwt-refresh\"))\n                    }\n                  }).then(function (res) {\n                    localStorage.setItem(\"jwt\", res.data[\"accept-token\"]);\n                    console.log(\"Update Token Success!\");\n                    setisLoading(false);\n                  })[\"catch\"](function (error) {\n                    console.log(\"Error Code\", error.response.status);\n                    Router.push(\"/page.covid1\");\n                  });\n                }\n\n                if (error.response.status === 404) {\n                  console.log(\"ไม่มีข้อมูลอยู่ในระบบ\");\n                  Router.push(\"/page.covid2\");\n                }\n              });\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function saveDataHandler() {\n      return _ref2.apply(this, arguments);\n    };\n  }(); //====================================================\n\n\n  if (isLoading) {\n    if (isEnd) {\n      if (!CheckSuccess) {\n        saveDataHandler();\n      }\n\n      return null;\n    } else {\n      return __jsx(FormItem, null, __jsx(\"div\", {\n        className: \"nu-font-covid\"\n      }, __jsx(\"div\", {\n        className: \"nu-flex-column-fs\"\n      }, __jsx(\"div\", null, __jsx(HeaderCovid, {\n        link: \"/page.covid4\"\n      })), __jsx(\"div\", {\n        className: \"nu-flex-row-bsauto-h100\"\n      }, __jsx(\"div\", {\n        className: \"nu-fs10-covidqt\"\n      }, __jsx(\"div\", null, __jsx(_Button, {\n        shape: \"circle\"\n      }, \"<\"))), __jsx(\"div\", {\n        className: \"nu-flex-column-bsauto-w100 nu-center-covidss nu-h100-covidqt\"\n      }, __jsx(\"div\", {\n        className: \"nu-dp-name-covidqt\"\n      }, __jsx(QuestionCovid, {\n        text: question,\n        check: token\n      })), __jsx(\"div\", {\n        className: \"nu-center-covidss nu-dp-btn-covidqt\"\n      }, __jsx(ButtonQuestion, {\n        click: nextQuestionHandler,\n        question: question\n      }))), __jsx(\"div\", {\n        className: \"nu-fs10-covidqt\"\n      }, __jsx(\"div\", {\n        style: {\n          textAlign: \"right\"\n        }\n      }, __jsx(_Button, {\n        shape: \"circle\"\n      }, \">\")))), __jsx(\"div\", {\n        className: \"nu-dp-ud-covidqt\"\n      }, __jsx(\"div\", {\n        className: \"nu-dp-pgnt-covidqt\"\n      }, __jsx(\"div\", {\n        className: \"nu-pgnt-covidqt\"\n      }, __jsx(\"div\", {\n        className: \"nu-box-covid1\",\n        style: {\n          marginLeft: \"8%\"\n        }\n      }, page.map(function (page, index) {\n        if (index === currentQuestion) {\n          return __jsx(\"span\", {\n            className: \"nu-box1-covid1\",\n            style: {\n              background: \"white\"\n            }\n          });\n        }\n\n        return __jsx(\"span\", {\n          className: \"nu-box1-covid1\"\n        });\n      })))), __jsx(\"div\", null, __jsx(AudioPlayer, {\n        url: options,\n        token: localStorage.getItem(\"jwt\"),\n        isLoading: isLoading\n      }))), __jsx(\"div\", {\n        className: \"nu-dptm-covidqt\"\n      }, __jsx(\"h5\", {\n        className: \"nu-h5-covidqt\"\n      }, __jsx(Duration, {\n        seconds: time\n      }))), __jsx(\"div\", null, __jsx(\"div\", {\n        className: \"w3-light-grey\"\n      }, __jsx(Box, null))), __jsx(\"div\", {\n        className: \"nu-dp-ud-covidqt\",\n        style: {\n          flexBasis: \"180px\"\n        }\n      }, __jsx(\"div\", {\n        className: \"nu-dp-pgnt-covidqt\"\n      }, __jsx(\"div\", {\n        className: \"sound-icon disabled\",\n        style: {\n          marginLeft: \"10%\"\n        }\n      }, __jsx(\"div\", {\n        className: \"sound-wave\"\n      }, __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      })))), __jsx(\"div\", {\n        style: {\n          height: \"100%\",\n          marginTop: \"20px\"\n        }\n      }, __jsx(Speechtotext, {\n        speech: nextQuestionHandler,\n        keyword: keyword,\n        page: \"covidquestion\"\n      }))), __jsx(\"div\", {\n        className: \"nu-flex-btn-covid1\"\n      }, __jsx(Copyright, null)))));\n    }\n  } else {\n    return null;\n  }\n}\n\nexport default CovidQuestion;","map":null,"metadata":{},"sourceType":"module"}