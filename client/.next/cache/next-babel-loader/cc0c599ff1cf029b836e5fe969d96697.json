{"ast":null,"code":"import \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nvar _jsxFileName = \"D:\\\\GitHub\\\\covid-web\\\\pages\\\\components\\\\component.snapshot.js\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState, useInterval } from \"react\";\nimport Webcam from \"react-webcam\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { updateFirstName, updateLastName, updateSsid, updateToken } from \"../../store/actions/postAction\";\nimport Router from \"next/router\";\nimport Axios from \"axios\";\nimport SuggestComponent from './component.suggestion';\nconst FormItem = _Form.Item;\nvar textAlertOne;\nvar textAlertTwo;\n\nconst WebcamCapture = () => {\n  const dispatch = useDispatch();\n  const webcamRef = React.useRef(null);\n  const [imgSrc, setImgSrc] = React.useState(null);\n  const {\n    token\n  } = useSelector(state => state.post);\n  const {\n    0: isLoading,\n    1: setisLoading\n  } = useState(false);\n  const {\n    0: isReadyCapture,\n    1: setisReacyCapture\n  } = useState(10);\n  const {\n    0: check,\n    1: setCheck\n  } = useState(\"block\");\n  const {\n    0: Alert,\n    1: setAlert\n  } = useState('none');\n  useEffect(() => {\n    dispatch(updateToken(localStorage.getItem(\"jwt\")));\n\n    if (localStorage.getItem(\"jwt\")) {\n      setisLoading(true);\n    } else {\n      Router.push(\"/page.covid1\");\n    }\n  }, []);\n  useEffect(() => {\n    if (isReadyCapture === 0) {\n      setAlert('block');\n      textAlertOne = \"กรุณารอสักครู่\";\n      capture();\n    } else {\n      if (isReadyCapture <= 0) {\n        return null;\n      } else {\n        setTimeout(() => {\n          setisReacyCapture(isReadyCapture - 1);\n\n          if (isReadyCapture === 1) {\n            setCheck(\"none\");\n          }\n        }, [1000]);\n      }\n    }\n  }, [isReadyCapture]);\n\n  const Axiosphoto = value => {\n    setAlert('none');\n    const Command = value;\n    console.log(Command.code);\n\n    if (Command.code === \"111\") {\n      //alert(\"กรุณาถอดหน้ากาก\");\n      textAlertOne = \"กรุณาถอดหน้ากาก\";\n      textAlertTwo = \"จะเริ่มทำการบันทึกภาพใหม่\";\n      setAlert('block');\n      setTimeout(() => {\n        setAlert('none');\n        textAlertOne = \"\";\n        textAlertTwo = \"\";\n        setisReacyCapture(10);\n        setCheck('block');\n      }, [5000]);\n    } else if (Command.code === \"100\") {\n      localStorage.setItem(\"user\", JSON.stringify(value.payload));\n      dispatch(updateSsid(value.payload.cid));\n      dispatch(updateFirstName(value.payload.fisrt_name));\n      dispatch(updateLastName(value.payload.last_name)); //alert(\"พบข้อมูล\");\n\n      textAlertOne = \"พบข้อมูล\";\n      textAlertTwo = \"กำลังไปหน้าต่อไป\";\n      setAlert('block');\n      setTimeout(() => {\n        textAlertOne = \"\";\n        textAlertTwo = \"\";\n        Router.push(\"/page.covid4\");\n      }, [2000]);\n    } else if (Command.code === \"110\") {\n      //alert(\"ไม่พบข้อมูล,กรุณาโชว์บัตรประชาชนแทน\");\n      textAlertOne = \"ไม่พบข้อมูล\";\n      textAlertTwo = \"กรุณาโชว์บัตรประชาชนแทน\";\n      setAlert('block');\n      setTimeout(() => {\n        setAlert('none');\n        textAlertOne = \"\";\n        textAlertTwo = \"\";\n        setisReacyCapture(10);\n        setCheck('block');\n      }, [5000]);\n    }\n  };\n\n  function taskOne() {\n    return new Promise(async resolve => {\n      const A = async () => {\n        const imageSrc = await webcamRef.current.getScreenshot();\n        localStorage.setItem(\"image\", imageSrc);\n        var block = await imageSrc.split(\";\");\n        var contentType = await block[0].split(\":\")[1];\n        var realData = await block[1].split(\",\")[1];\n        var blob = await b64toBlob(realData, contentType);\n        resolve(blob);\n      };\n\n      await A();\n    });\n  }\n\n  function taskTwo(value) {\n    return new Promise(async resolve => {\n      const B = async () => {\n        await console.log(\"A\", value);\n        const formData = await new FormData();\n        await formData.append(\"picture\", value);\n        return formData;\n      };\n\n      const postimage = async () => {\n        console.log('FormData', formData);\n        /*await Axios.post(\r\n          \"https://www.nuscreening.kasemsanm.com/api/v1/faceDetect/1\",\r\n          formData,\r\n          {\r\n            headers: {\r\n              Authorization: `Bearer ${localStorage.getItem(\"jwt\")}`,\r\n              \"Content-Type\": \"multipart/form-data\",\r\n            },\r\n          }\r\n        )\r\n          .then((res) => {\r\n            console.log(\"success\", res.data);\r\n            Axiosphoto(res.data);\r\n          })\r\n          .catch((err) => {\r\n            console.log(\"เตือนไม่พอข้อมูล\", err.response.status);\r\n            if (err.response.status === 401) {\r\n              Axios({\r\n                method: \"GET\",\r\n                url:\r\n                  \"https://www.nuscreening.kasemsanm.com/api/v1/manage/token\",\r\n                headers: {\r\n                  Authorization: `Bearer ${localStorage.getItem(\r\n                    \"jwt-refresh\"\r\n                  )}`,\r\n                },\r\n              })\r\n                .then((res) => {\r\n                  localStorage.setItem(\"jwt\", res.data[\"accessToken\"]);\r\n                  localStorage.setItem(\"jwt-refresh\", res.data[\"refreshToken\"]);\r\n                  dispatch(updateToken(res.data[\"accessToken\"]));\r\n                  console.log(\"Update Token Success!\", res);\r\n                  postimage();\r\n                })\r\n                .catch((error) => {\r\n                  console.log(\"Error Code\", error.response.status);\r\n                  Router.push(\"/page.covid1\");\r\n                });\r\n            }\r\n          });*/\n\n        let data = {\n          \"code\": 100,\n          \"payload\": {\n            \"cid\": 3640600077526,\n            \"fisrt_name\": \"Panuwit\",\n            \"last_name\": \"Makmee\"\n          }\n        };\n        Axiosphoto(data);\n      };\n\n      var formData = await B();\n      await postimage();\n    });\n  }\n\n  const main = async () => {\n    var result = await taskOne();\n    await taskTwo(result);\n  };\n\n  const capture = () => {\n    main();\n  };\n  /*const [statee, setStatee] = useState(null);\r\n  const fileSelectedHandler = (event) => {\r\n    setStatee(event.target.files[0]);\r\n    console.log(event.target.files[0]);\r\n  };\r\n  const fileUploadHandler = () => {\r\n    console.log(\"TEST\", statee);\r\n    const fd = new FormData();\r\n    fd.append(\"picture\", statee);\r\n    Axios.post(\"http://34.87.54.114:8003/api/v1/file/uploadphoto\", fd, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"multipart/form-data\",\r\n      },\r\n    })\r\n      .then((res) => {\r\n        console.log(\"success\", res);\r\n      })\r\n      .catch((err) => {\r\n        console.log(\"err\", err);\r\n      });\r\n  };*/\n\n\n  function b64toBlob(b64Data, contentType, sliceSize) {\n    contentType = contentType || \"\";\n    sliceSize = sliceSize || 512;\n    var byteCharacters = atob(b64Data);\n    var byteArrays = [];\n\n    for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {\n      var slice = byteCharacters.slice(offset, offset + sliceSize);\n      var byteNumbers = new Array(slice.length);\n\n      for (var i = 0; i < slice.length; i++) {\n        byteNumbers[i] = slice.charCodeAt(i);\n      }\n\n      var byteArray = new Uint8Array(byteNumbers);\n      byteArrays.push(byteArray);\n    }\n\n    var blob = new Blob(byteArrays, {\n      type: contentType\n    });\n    return blob;\n  }\n  /*const test = () => {\r\n    var ImageURL = data;\r\n    console.log(ImageURL);\r\n    var block = ImageURL.split(\";\");\r\n    var contentType = block[0].split(\":\")[1];\r\n    var realData = block[1].split(\",\")[1];\r\n    var blob = b64toBlob(realData, contentType);\r\n    console.log(blob);\r\n    const fd = new FormData();\r\n    fd.append(\"picture\", blob);\r\n    Axios.post(\"http://34.87.54.114:8003/api/v1/file/uploadphoto\", fd, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"multipart/form-data\",\r\n      },\r\n    })\r\n      .then((res) => {\r\n        console.log(\"success\", res);\r\n      })\r\n      .catch((err) => {\r\n        console.log(\"err\", err);\r\n      });\r\n  };*/\n\n\n  if (isLoading) {\n    const keyword = [\"พร้อมถ่าย\"];\n    return __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 7\n      }\n    }, __jsx(FormItem, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 9\n      }\n    }, __jsx(\"div\", {\n      style: {\n        display: check\n      },\n      className: \"modal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 11\n      }\n    }, __jsx(\"div\", {\n      className: \"modal-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 13\n      }\n    }, __jsx(\"h1\", {\n      style: {\n        fontSize: \"100px\",\n        opacity: \"0.8\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 15\n      }\n    }, isReadyCapture))), __jsx(\"div\", {\n      style: {\n        display: Alert\n      },\n      className: \"modal cl-modal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 11\n      }\n    }, __jsx(\"div\", {\n      className: \"modal-content cl-modal-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 13\n      }\n    }, __jsx(SuggestComponent, {\n      page: \"snapshot\",\n      textAlertOne: textAlertOne,\n      textAlertTwo: textAlertTwo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 15\n      }\n    }))), __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 11\n      }\n    }, __jsx(Webcam, {\n      audio: false,\n      ref: webcamRef,\n      screenshotFormat: \"image/jpeg\",\n      style: {\n        borderRadius: \"20px\",\n        color: \"white\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 13\n      }\n    }))));\n  } else {\n    return null;\n  }\n};\n\nexport default WebcamCapture;","map":{"version":3,"sources":["D:/GitHub/covid-web/pages/components/component.snapshot.js"],"names":["React","useEffect","useState","useInterval","Webcam","useDispatch","useSelector","updateFirstName","updateLastName","updateSsid","updateToken","Router","Axios","SuggestComponent","FormItem","Item","textAlertOne","textAlertTwo","WebcamCapture","dispatch","webcamRef","useRef","imgSrc","setImgSrc","token","state","post","isLoading","setisLoading","isReadyCapture","setisReacyCapture","check","setCheck","Alert","setAlert","localStorage","getItem","push","capture","setTimeout","Axiosphoto","value","Command","console","log","code","setItem","JSON","stringify","payload","cid","fisrt_name","last_name","taskOne","Promise","resolve","A","imageSrc","current","getScreenshot","block","split","contentType","realData","blob","b64toBlob","taskTwo","B","formData","FormData","append","postimage","data","main","result","b64Data","sliceSize","byteCharacters","atob","byteArrays","offset","length","slice","byteNumbers","Array","i","charCodeAt","byteArray","Uint8Array","Blob","type","keyword","display","fontSize","opacity","borderRadius","color"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useInterval } from \"react\";\r\nimport Webcam from \"react-webcam\";\r\nimport { Form, Button } from \"antd\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport {\r\n  updateFirstName,\r\n  updateLastName,\r\n  updateSsid,\r\n  updateToken,\r\n} from \"../../store/actions/postAction\";\r\nimport Router from \"next/router\";\r\nimport Axios from \"axios\";\r\nimport SuggestComponent from './component.suggestion'\r\n\r\nconst FormItem = Form.Item;\r\nvar textAlertOne;\r\nvar textAlertTwo;\r\n\r\nconst WebcamCapture = () => {\r\n  const dispatch = useDispatch();\r\n  const webcamRef = React.useRef(null);\r\n  const [imgSrc, setImgSrc] = React.useState(null);\r\n  const { token } = useSelector((state) => state.post);\r\n  const [isLoading, setisLoading] = useState(false);\r\n  const [isReadyCapture, setisReacyCapture] = useState(10);\r\n  const [check, setCheck] = useState(\"block\");\r\n  const [Alert,setAlert] = useState('none');\r\n\r\n  useEffect(() => {\r\n    dispatch(updateToken(localStorage.getItem(\"jwt\")));\r\n    if (localStorage.getItem(\"jwt\")) {\r\n      setisLoading(true);\r\n    } else {\r\n      Router.push(\"/page.covid1\");\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (isReadyCapture === 0) {\r\n      setAlert('block');\r\n      textAlertOne = \"กรุณารอสักครู่\"\r\n      capture();\r\n    } else {\r\n      if (isReadyCapture <= 0) {\r\n        return null;\r\n      } else {\r\n        setTimeout(() => {\r\n          setisReacyCapture(isReadyCapture - 1);\r\n          if (isReadyCapture === 1) {\r\n            setCheck(\"none\");\r\n          }\r\n        }, [1000]);\r\n      }\r\n    }\r\n  }, [isReadyCapture]);\r\n\r\n  const Axiosphoto = (value) => {\r\n    setAlert('none')\r\n    const Command = value;\r\n    console.log(Command.code);\r\n    if (Command.code === \"111\") {\r\n      //alert(\"กรุณาถอดหน้ากาก\");\r\n      textAlertOne = \"กรุณาถอดหน้ากาก\"\r\n      textAlertTwo = \"จะเริ่มทำการบันทึกภาพใหม่\"\r\n      setAlert('block')\r\n      setTimeout(()=>{\r\n        setAlert('none');\r\n        textAlertOne = \"\";\r\n        textAlertTwo = \"\";\r\n        setisReacyCapture(10);\r\n        setCheck('block');\r\n      },[5000])\r\n    } else if (Command.code === \"100\") {\r\n      localStorage.setItem(\"user\", JSON.stringify(value.payload));\r\n      dispatch(updateSsid(value.payload.cid));\r\n      dispatch(updateFirstName(value.payload.fisrt_name));\r\n      dispatch(updateLastName(value.payload.last_name));\r\n      //alert(\"พบข้อมูล\");\r\n      textAlertOne = \"พบข้อมูล\"\r\n      textAlertTwo = \"กำลังไปหน้าต่อไป\"\r\n      setAlert('block')\r\n      setTimeout(()=>{\r\n        textAlertOne = \"\";\r\n        textAlertTwo = \"\";\r\n        Router.push(\"/page.covid4\");\r\n      },[2000])\r\n    } else if (Command.code === \"110\") {\r\n      //alert(\"ไม่พบข้อมูล,กรุณาโชว์บัตรประชาชนแทน\");\r\n      textAlertOne = \"ไม่พบข้อมูล\"\r\n      textAlertTwo = \"กรุณาโชว์บัตรประชาชนแทน\"\r\n      setAlert('block')\r\n      setTimeout(()=>{\r\n        setAlert('none');\r\n        textAlertOne = \"\";\r\n        textAlertTwo = \"\";\r\n        setisReacyCapture(10);\r\n        setCheck('block')\r\n      },[5000])\r\n    }\r\n  };\r\n  function taskOne() {\r\n    return new Promise(async (resolve) => {\r\n      const A = async () => {\r\n        const imageSrc = await webcamRef.current.getScreenshot();\r\n        localStorage.setItem(\"image\", imageSrc);\r\n        var block = await imageSrc.split(\";\");\r\n        var contentType = await block[0].split(\":\")[1];\r\n        var realData = await block[1].split(\",\")[1];\r\n        var blob = await b64toBlob(realData, contentType);\r\n        resolve(blob);\r\n      };\r\n      await A();\r\n    });\r\n  }\r\n  function taskTwo(value) {\r\n    return new Promise(async (resolve) => {\r\n      const B = async () => {\r\n        await console.log(\"A\", value);\r\n        const formData = await new FormData();\r\n        await formData.append(\"picture\", value);\r\n        return formData;\r\n      };\r\n      const postimage = async () => {\r\n        console.log('FormData',formData)\r\n        /*await Axios.post(\r\n          \"https://www.nuscreening.kasemsanm.com/api/v1/faceDetect/1\",\r\n          formData,\r\n          {\r\n            headers: {\r\n              Authorization: `Bearer ${localStorage.getItem(\"jwt\")}`,\r\n              \"Content-Type\": \"multipart/form-data\",\r\n            },\r\n          }\r\n        )\r\n          .then((res) => {\r\n            console.log(\"success\", res.data);\r\n            Axiosphoto(res.data);\r\n          })\r\n          .catch((err) => {\r\n            console.log(\"เตือนไม่พอข้อมูล\", err.response.status);\r\n            if (err.response.status === 401) {\r\n              Axios({\r\n                method: \"GET\",\r\n                url:\r\n                  \"https://www.nuscreening.kasemsanm.com/api/v1/manage/token\",\r\n                headers: {\r\n                  Authorization: `Bearer ${localStorage.getItem(\r\n                    \"jwt-refresh\"\r\n                  )}`,\r\n                },\r\n              })\r\n                .then((res) => {\r\n                  localStorage.setItem(\"jwt\", res.data[\"accessToken\"]);\r\n                  localStorage.setItem(\"jwt-refresh\", res.data[\"refreshToken\"]);\r\n                  dispatch(updateToken(res.data[\"accessToken\"]));\r\n                  console.log(\"Update Token Success!\", res);\r\n                  postimage();\r\n                })\r\n                .catch((error) => {\r\n                  console.log(\"Error Code\", error.response.status);\r\n                  Router.push(\"/page.covid1\");\r\n                });\r\n            }\r\n          });*/\r\n          let data = {\r\n            \"code\":100,\r\n            \"payload\":{\r\n              \"cid\":3640600077526,\r\n              \"fisrt_name\":\"Panuwit\",\r\n              \"last_name\":\"Makmee\"\r\n            }\r\n          }\r\n          Axiosphoto(data);\r\n      };\r\n      var formData = await B();\r\n      await postimage();\r\n    });\r\n  }\r\n\r\n  const main = async () => {\r\n    var result = await taskOne();\r\n    await taskTwo(result);\r\n  };\r\n\r\n  const capture = () => {\r\n    main();\r\n  };\r\n\r\n  /*const [statee, setStatee] = useState(null);\r\n  const fileSelectedHandler = (event) => {\r\n    setStatee(event.target.files[0]);\r\n    console.log(event.target.files[0]);\r\n  };\r\n  const fileUploadHandler = () => {\r\n    console.log(\"TEST\", statee);\r\n    const fd = new FormData();\r\n    fd.append(\"picture\", statee);\r\n    Axios.post(\"http://34.87.54.114:8003/api/v1/file/uploadphoto\", fd, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"multipart/form-data\",\r\n      },\r\n    })\r\n      .then((res) => {\r\n        console.log(\"success\", res);\r\n      })\r\n      .catch((err) => {\r\n        console.log(\"err\", err);\r\n      });\r\n  };*/\r\n\r\n  function b64toBlob(b64Data, contentType, sliceSize) {\r\n    contentType = contentType || \"\";\r\n    sliceSize = sliceSize || 512;\r\n    var byteCharacters = atob(b64Data);\r\n    var byteArrays = [];\r\n    for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {\r\n      var slice = byteCharacters.slice(offset, offset + sliceSize);\r\n      var byteNumbers = new Array(slice.length);\r\n      for (var i = 0; i < slice.length; i++) {\r\n        byteNumbers[i] = slice.charCodeAt(i);\r\n      }\r\n      var byteArray = new Uint8Array(byteNumbers);\r\n      byteArrays.push(byteArray);\r\n    }\r\n    var blob = new Blob(byteArrays, { type: contentType });\r\n    return blob;\r\n  }\r\n\r\n  /*const test = () => {\r\n    var ImageURL = data;\r\n    console.log(ImageURL);\r\n    var block = ImageURL.split(\";\");\r\n    var contentType = block[0].split(\":\")[1];\r\n    var realData = block[1].split(\",\")[1];\r\n    var blob = b64toBlob(realData, contentType);\r\n    console.log(blob);\r\n    const fd = new FormData();\r\n    fd.append(\"picture\", blob);\r\n    Axios.post(\"http://34.87.54.114:8003/api/v1/file/uploadphoto\", fd, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"multipart/form-data\",\r\n      },\r\n    })\r\n      .then((res) => {\r\n        console.log(\"success\", res);\r\n      })\r\n      .catch((err) => {\r\n        console.log(\"err\", err);\r\n      });\r\n  };*/\r\n\r\n  if (isLoading) {\r\n    const keyword = [\"พร้อมถ่าย\"];\r\n    return (\r\n      <div>\r\n        <FormItem>\r\n          <div style={{ display: check }} className=\"modal\">\r\n            <div className=\"modal-content\">\r\n              <h1 style={{ fontSize: \"100px\", opacity: \"0.8\" }}>\r\n                {isReadyCapture}\r\n              </h1>\r\n            </div>\r\n          </div>\r\n\r\n          <div style={{ display: Alert }} className=\"modal cl-modal\">\r\n            <div className=\"modal-content cl-modal-content\">\r\n              <SuggestComponent page={\"snapshot\"} textAlertOne={textAlertOne} textAlertTwo={textAlertTwo} />\r\n            </div>\r\n          </div>\r\n\r\n          <div>\r\n            <Webcam\r\n              audio={false}\r\n              ref={webcamRef}\r\n              screenshotFormat=\"image/jpeg\"\r\n              style={{ borderRadius: \"20px\", color: \"white\" }}\r\n            />\r\n          </div>\r\n        </FormItem>\r\n      </div>\r\n    );\r\n  } else {\r\n    return null;\r\n  }\r\n};\r\n\r\nexport default WebcamCapture;\r\n"]},"metadata":{},"sourceType":"module"}