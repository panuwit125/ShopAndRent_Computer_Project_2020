{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nvar _jsxFileName = \"D:\\\\Coding\\\\covid-web-develop\\\\covid-web-develop\\\\pages\\\\components\\\\component.snapshot.js\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from \"react\";\nimport Webcam from \"react-webcam\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { updateFirstName, updateLastName, updateSsid, updateToken } from \"../../store/actions/postAction\";\nimport Router from \"next/router\";\nimport Axios from \"axios\";\nconst FormItem = _Form.Item;\n\nconst WebcamCapture = () => {\n  const dispatch = useDispatch();\n  const webcamRef = React.useRef(null);\n  const [imgSrc, setImgSrc] = React.useState(null);\n  const {\n    token\n  } = useSelector(state => state.post);\n  const {\n    0: isLoading,\n    1: setisLoading\n  } = useState(false);\n  const {\n    0: isReadyCapture,\n    1: setisReacyCapture\n  } = useState(3);\n  useEffect(() => {\n    //dispatch(updateToken(localStorage.getItem('jwt')))\n    if (localStorage.getItem('jwt')) {\n      setisLoading(true);\n    } else {\n      Router.push(\"/page.covid1\");\n    }\n  }, []);\n\n  const Axiosphoto = value => {\n    const Command = value;\n    console.log(Command);\n\n    if (Command === \"Errormask\") {\n      alert(\"กรุณาถอดหน้ากาก\");\n    } else if (Command === \"FoundData\") {\n      const Data = [\"3640600077526\", \"สมชาย\", \"หมายปอง\"];\n      localStorage.setItem('User', Data);\n      dispatch(updateSsid(Data[0]));\n      dispatch(updateFirstName(Data[1]));\n      dispatch(updateLastName(Data[2]));\n      alert(\"พบข้อมูล\");\n      Router.push(\"/page.covid4\");\n    } else if (Command === \"NotFoundData\") {\n      alert(\"ไม่พบข้อมูล,กรุณาโชว์บัตรประชาชนแทน\");\n    }\n  };\n\n  function taskOne() {\n    return new Promise(async resolve => {\n      const A = async () => {\n        await console.log(\"Token\", token);\n        const imageSrc = await webcamRef.current.getScreenshot();\n        await console.log(imageSrc);\n        var block = await imageSrc.split(\";\");\n        var contentType = await block[0].split(\":\")[1];\n        var realData = await block[1].split(\",\")[1];\n        var blob = await b64toBlob(realData, contentType);\n        resolve(blob);\n      };\n\n      await A();\n    });\n  }\n\n  function taskTwo(value) {\n    return new Promise(async resolve => {\n      const B = async () => {\n        await console.log(\"A\", value);\n        const formData = await new FormData();\n        await formData.append(\"picture\", value);\n        return formData;\n      };\n\n      const postimage = async () => {\n        await Axios.post(\"http://34.87.54.114:8003/api/v1/file/uploadphoto\", formData, {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem(\"jwt\")}`,\n            \"Content-Type\": \"multipart/form-data\"\n          }\n        }).then(res => {\n          console.log(\"success\", res);\n          Axiosphoto(\"FoundData\");\n        }).catch(err => {\n          console.log(\"เตือนไม่พอข้อมูล\", err.response.status);\n\n          if (err.response.status === 401) {\n            Axios({\n              method: \"GET\",\n              url: \"http://34.87.54.114:8003/api/v1/manage/token\",\n              headers: {\n                Authorization: `Bearer ${localStorage.getItem(\"jwt-refresh\")}`\n              }\n            }).then(res => {\n              localStorage.setItem(\"jwt\", res.data[\"accessToken\"]);\n              localStorage.setItem('jwt-refresh', res.data[\"refreshToken\"]);\n              dispatch(updateToken(res.data[\"accessToken\"]));\n              console.log(\"Update Token Success!\", res);\n              postimage();\n            }).catch(error => {\n              console.log(\"Error Code\", error.response.status);\n              Router.push(\"/page.covid1\");\n            });\n          }\n        });\n      };\n\n      var formData = await B();\n      await postimage();\n    });\n  }\n\n  const main = async () => {\n    var result = await taskOne();\n    await taskTwo(result);\n  };\n\n  const promiseCapture = async () => {\n    const A = () => {\n      return new Promise(resolve => {\n        setInterval(() => {\n          setisReacyCapture(isReadyCapture - 1);\n          resolve();\n        }, 1000);\n      });\n    };\n\n    const B = () => {\n      return new Promise(resolve => {\n        capture();\n        resolve();\n      });\n    };\n\n    await A();\n    await B();\n  };\n\n  const capture = React.useCallback(async () => {\n    if (isReadyCapture > 0) {\n      promiseCapture();\n    } else {\n      main();\n    }\n  }, [webcamRef, setImgSrc]);\n  /*const [statee, setStatee] = useState(null);\r\n  const fileSelectedHandler = (event) => {\r\n    setStatee(event.target.files[0]);\r\n    console.log(event.target.files[0]);\r\n  };\r\n  const fileUploadHandler = () => {\r\n    console.log(\"TEST\", statee);\r\n    const fd = new FormData();\r\n    fd.append(\"picture\", statee);\r\n    Axios.post(\"http://34.87.54.114:8003/api/v1/file/uploadphoto\", fd, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"multipart/form-data\",\r\n      },\r\n    })\r\n      .then((res) => {\r\n        console.log(\"success\", res);\r\n      })\r\n      .catch((err) => {\r\n        console.log(\"err\", err);\r\n      });\r\n  };*/\n\n  function b64toBlob(b64Data, contentType, sliceSize) {\n    contentType = contentType || \"\";\n    sliceSize = sliceSize || 512;\n    var byteCharacters = atob(b64Data);\n    var byteArrays = [];\n\n    for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {\n      var slice = byteCharacters.slice(offset, offset + sliceSize);\n      var byteNumbers = new Array(slice.length);\n\n      for (var i = 0; i < slice.length; i++) {\n        byteNumbers[i] = slice.charCodeAt(i);\n      }\n\n      var byteArray = new Uint8Array(byteNumbers);\n      byteArrays.push(byteArray);\n    }\n\n    var blob = new Blob(byteArrays, {\n      type: contentType\n    });\n    return blob;\n  }\n  /*const test = () => {\r\n    var ImageURL = data;\r\n    console.log(ImageURL);\r\n    var block = ImageURL.split(\";\");\r\n    var contentType = block[0].split(\":\")[1];\r\n    var realData = block[1].split(\",\")[1];\r\n    var blob = b64toBlob(realData, contentType);\r\n    console.log(blob);\r\n    const fd = new FormData();\r\n    fd.append(\"picture\", blob);\r\n    Axios.post(\"http://34.87.54.114:8003/api/v1/file/uploadphoto\", fd, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"multipart/form-data\",\r\n      },\r\n    })\r\n      .then((res) => {\r\n        console.log(\"success\", res);\r\n      })\r\n      .catch((err) => {\r\n        console.log(\"err\", err);\r\n      });\r\n  };*/\n\n\n  if (isLoading) {\n    return __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 7\n      }\n    }, __jsx(FormItem, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }\n    }, __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 11\n      }\n    }, __jsx(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 13\n      }\n    }, isReadyCapture), __jsx(Webcam, {\n      audio: false,\n      ref: webcamRef,\n      screenshotFormat: \"image/jpeg\",\n      style: {\n        borderRadius: \"20px\",\n        color: \"white\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 13\n      }\n    }, __jsx(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 14\n      }\n    }, \"AAA\"))), __jsx(_Button, {\n      onClick: capture,\n      style: {\n        width: \"100%\"\n      },\n      type: \"primary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 11\n      }\n    }, \"Capture photo\"), __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 11\n      }\n    }, __jsx(\"img\", {\n      src: imgSrc,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 13\n      }\n    }))));\n  } else {\n    console.log(\"Loading....\");\n    return null;\n  }\n};\n\nexport default WebcamCapture;","map":{"version":3,"sources":["D:/Coding/covid-web-develop/covid-web-develop/pages/components/component.snapshot.js"],"names":["React","useEffect","useState","Webcam","useDispatch","useSelector","updateFirstName","updateLastName","updateSsid","updateToken","Router","Axios","FormItem","Item","WebcamCapture","dispatch","webcamRef","useRef","imgSrc","setImgSrc","token","state","post","isLoading","setisLoading","isReadyCapture","setisReacyCapture","localStorage","getItem","push","Axiosphoto","value","Command","console","log","alert","Data","setItem","taskOne","Promise","resolve","A","imageSrc","current","getScreenshot","block","split","contentType","realData","blob","b64toBlob","taskTwo","B","formData","FormData","append","postimage","headers","Authorization","then","res","catch","err","response","status","method","url","data","error","main","result","promiseCapture","setInterval","capture","useCallback","b64Data","sliceSize","byteCharacters","atob","byteArrays","offset","length","slice","byteNumbers","Array","i","charCodeAt","byteArray","Uint8Array","Blob","type","borderRadius","color","width"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport Webcam from \"react-webcam\";\r\nimport {\r\n  Form,\r\n  Button,\r\n} from \"antd\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport {\r\n  updateFirstName,\r\n  updateLastName,\r\n  updateSsid,\r\n  updateToken\r\n} from \"../../store/actions/postAction\";\r\nimport Router from \"next/router\";\r\nimport Axios from \"axios\";\r\n\r\nconst FormItem = Form.Item;\r\n\r\nconst WebcamCapture = () => {\r\n  const dispatch = useDispatch();\r\n  const webcamRef = React.useRef(null);\r\n  const [imgSrc, setImgSrc] = React.useState(null);\r\n  const { token } = useSelector((state) => state.post);\r\n  const [isLoading, setisLoading] = useState(false);\r\n  const [isReadyCapture,setisReacyCapture] = useState(3);\r\n\r\n  useEffect(() => {\r\n    //dispatch(updateToken(localStorage.getItem('jwt')))\r\n    if(localStorage.getItem('jwt')){\r\n      setisLoading(true)\r\n    } else {\r\n      Router.push(\"/page.covid1\");\r\n    }\r\n  },[]);\r\n\r\n  const Axiosphoto = (value) => {\r\n    const Command = value;\r\n    console.log(Command);\r\n    if (Command === \"Errormask\") {\r\n      alert(\"กรุณาถอดหน้ากาก\");\r\n    } else if (Command === \"FoundData\") {\r\n      const Data = [\"3640600077526\", \"สมชาย\", \"หมายปอง\"];\r\n      localStorage.setItem('User',Data)\r\n      dispatch(updateSsid(Data[0]));\r\n      dispatch(updateFirstName(Data[1]));\r\n      dispatch(updateLastName(Data[2]));\r\n      alert(\"พบข้อมูล\");\r\n      Router.push(\"/page.covid4\");\r\n    } else if (Command === \"NotFoundData\") {\r\n      alert(\"ไม่พบข้อมูล,กรุณาโชว์บัตรประชาชนแทน\");\r\n    }\r\n  };\r\n  function taskOne() {\r\n    return new Promise(async (resolve) => {\r\n      const A = async () => {\r\n        await console.log(\"Token\", token);\r\n        const imageSrc = await webcamRef.current.getScreenshot();\r\n        await console.log(imageSrc);\r\n        var block = await imageSrc.split(\";\");\r\n        var contentType = await block[0].split(\":\")[1];\r\n        var realData = await block[1].split(\",\")[1];\r\n        var blob = await b64toBlob(realData, contentType);\r\n        resolve(blob);\r\n      };\r\n      await A();\r\n    });\r\n  }\r\n  function taskTwo(value) {\r\n    return new Promise(async (resolve) => {\r\n      const B = async () => {\r\n        await console.log(\"A\", value);\r\n        const formData = await new FormData();\r\n        await formData.append(\"picture\", value);\r\n        return formData;\r\n      };\r\n      const postimage = async () => {\r\n        await Axios.post(\r\n          \"http://34.87.54.114:8003/api/v1/file/uploadphoto\",\r\n          formData,\r\n          {\r\n            headers: {\r\n              Authorization: `Bearer ${localStorage.getItem(\"jwt\")}`,\r\n              \"Content-Type\": \"multipart/form-data\",\r\n            },\r\n          }\r\n        )\r\n          .then((res) => {\r\n            console.log(\"success\", res);\r\n            Axiosphoto(\"FoundData\");\r\n          })\r\n          .catch((err) => {\r\n            console.log(\"เตือนไม่พอข้อมูล\", err.response.status);\r\n            if (err.response.status === 401) {\r\n              Axios({\r\n                method: \"GET\",\r\n                url: \"http://34.87.54.114:8003/api/v1/manage/token\",\r\n                headers: {\r\n                  Authorization: `Bearer ${localStorage.getItem(\"jwt-refresh\")}`,\r\n                },\r\n              })\r\n                .then((res) => {\r\n                  localStorage.setItem(\"jwt\", res.data[\"accessToken\"]);\r\n                  localStorage.setItem('jwt-refresh', res.data[\"refreshToken\"])\r\n                  dispatch(updateToken(res.data[\"accessToken\"]))\r\n                  console.log(\"Update Token Success!\",res);\r\n                  postimage();\r\n                })\r\n                .catch((error) => {\r\n                  console.log(\"Error Code\", error.response.status);\r\n                  Router.push(\"/page.covid1\");\r\n                });\r\n            }\r\n          });\r\n      };\r\n      var formData = await B();\r\n      await postimage();\r\n    });\r\n  }\r\n\r\n  const main = async () => {\r\n    var result = await taskOne();\r\n    await taskTwo(result);\r\n  };\r\n\r\n  const promiseCapture = async() => {\r\n    const A = () => {\r\n      return new Promise((resolve)=>{\r\n        setInterval(()=>{\r\n          setisReacyCapture(isReadyCapture-1);\r\n          resolve();\r\n        },1000)\r\n      })\r\n    }\r\n    const B = () => {\r\n      return new Promise((resolve)=>{\r\n        capture();\r\n        resolve();\r\n      })\r\n    }\r\n    await A();\r\n    await B();\r\n  }\r\n\r\n  const capture = React.useCallback(async () => {\r\n    if (isReadyCapture > 0) {\r\n      promiseCapture();\r\n    } else {\r\n      main();\r\n    }\r\n  }, [webcamRef, setImgSrc]);\r\n\r\n  /*const [statee, setStatee] = useState(null);\r\n  const fileSelectedHandler = (event) => {\r\n    setStatee(event.target.files[0]);\r\n    console.log(event.target.files[0]);\r\n  };\r\n  const fileUploadHandler = () => {\r\n    console.log(\"TEST\", statee);\r\n    const fd = new FormData();\r\n    fd.append(\"picture\", statee);\r\n    Axios.post(\"http://34.87.54.114:8003/api/v1/file/uploadphoto\", fd, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"multipart/form-data\",\r\n      },\r\n    })\r\n      .then((res) => {\r\n        console.log(\"success\", res);\r\n      })\r\n      .catch((err) => {\r\n        console.log(\"err\", err);\r\n      });\r\n  };*/\r\n\r\n  function b64toBlob(b64Data, contentType, sliceSize) {\r\n    contentType = contentType || \"\";\r\n    sliceSize = sliceSize || 512;\r\n    var byteCharacters = atob(b64Data);\r\n    var byteArrays = [];\r\n    for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {\r\n      var slice = byteCharacters.slice(offset, offset + sliceSize);\r\n      var byteNumbers = new Array(slice.length);\r\n      for (var i = 0; i < slice.length; i++) {\r\n        byteNumbers[i] = slice.charCodeAt(i);\r\n      }\r\n      var byteArray = new Uint8Array(byteNumbers);\r\n      byteArrays.push(byteArray);\r\n    }\r\n    var blob = new Blob(byteArrays, { type: contentType });\r\n    return blob;\r\n  }\r\n\r\n  /*const test = () => {\r\n    var ImageURL = data;\r\n    console.log(ImageURL);\r\n    var block = ImageURL.split(\";\");\r\n    var contentType = block[0].split(\":\")[1];\r\n    var realData = block[1].split(\",\")[1];\r\n    var blob = b64toBlob(realData, contentType);\r\n    console.log(blob);\r\n    const fd = new FormData();\r\n    fd.append(\"picture\", blob);\r\n    Axios.post(\"http://34.87.54.114:8003/api/v1/file/uploadphoto\", fd, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"multipart/form-data\",\r\n      },\r\n    })\r\n      .then((res) => {\r\n        console.log(\"success\", res);\r\n      })\r\n      .catch((err) => {\r\n        console.log(\"err\", err);\r\n      });\r\n  };*/\r\n  if (isLoading) {\r\n    return (\r\n      <div>\r\n        <FormItem>\r\n          <div>\r\n            <h1>{isReadyCapture}</h1>\r\n            <Webcam\r\n              audio={false}\r\n              ref={webcamRef}\r\n              screenshotFormat=\"image/jpeg\"\r\n              style={{ borderRadius: \"20px\",color:\"white\" }}\r\n            ><h1>AAA</h1></Webcam>\r\n          </div>\r\n          <Button onClick={capture} style={{ width: \"100%\" }} type=\"primary\">\r\n            Capture photo\r\n          </Button>\r\n          <div>\r\n            <img src={imgSrc} />\r\n            {/*<input type=\"file\" onChange={fileSelectedHandler} />\r\n          <button onClick={fileUploadHandler}>Upload</button>\r\n          <button onClick={test}>Upload TEST</button>*/}\r\n          </div>\r\n        </FormItem>\r\n      </div>\r\n    );\r\n  } else {\r\n    console.log(\"Loading....\");\r\n    return null;\r\n  }\r\n};\r\n\r\nexport default WebcamCapture;\r\n"]},"metadata":{},"sourceType":"module"}