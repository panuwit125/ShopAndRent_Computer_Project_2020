{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nvar __jsx = React.createElement;\nimport Router from \"next/router\";\nimport React, { useState, useEffect } from \"react\";\nimport HeaderCovid from \"./components/component.headercovid\";\nimport QuestionCovid from \"./components/component.question\";\nimport styled, { keyframes } from \"styled-components\";\nimport { useSelector } from \"react-redux\";\nimport img1 from \"../public/9.png\";\nimport Axios from \"axios\";\nimport AudioPlayer from \"./components/component.audioplayer\";\nimport Duration from \"./components/component.duration\";\nimport Speechtotext from \"./components/component.speechtotext\";\nimport Copyright from \"./components/component.footercopyright\";\nimport ButtonQuestion from \"./components/component.buttonquestion\";\nconst FormItem = _Form.Item;\n\nfunction CovidQuestion(props) {\n  //State จัดการ Button\n  const {\n    0: showResults,\n    1: setShowResults\n  } = useState(false); //State จัดการเรื่องชุดคำถาม =========================\n\n  const {\n    0: page,\n    1: setPage\n  } = useState([]);\n  const {\n    0: currentQuestion,\n    1: setCurrentQuestion\n  } = useState(0);\n  const {\n    0: score,\n    1: setscore\n  } = useState(0);\n  const {\n    0: disabled,\n    1: setdisabled\n  } = useState(true);\n  const {\n    0: isEnd,\n    1: setisEnd\n  } = useState(false);\n  const {\n    0: isLoading,\n    1: setisLoading\n  } = useState(false);\n  const {\n    0: options,\n    1: setoptions\n  } = useState(\"\");\n  const {\n    0: question,\n    1: setQuestion\n  } = useState(\"\");\n  const {\n    0: timer,\n    1: setTimer\n  } = useState(20);\n  const {\n    0: token,\n    1: settoken\n  } = useState(false);\n  const {\n    0: keyword,\n    1: setKeyword\n  } = useState([]);\n  const {\n    Name,\n    SSID,\n    PostId,\n    BirdDay,\n    time\n  } = useSelector(state => state.post); //จัดการชุดคำตอบที่จะส่งไปตอนเสร็จ\n\n  const {\n    0: questionNo,\n    1: setQuestionNo\n  } = useState([]);\n  const {\n    0: answerQuestion,\n    1: setAnswerQuestion\n  } = useState([]);\n  const {\n    0: questionID,\n    1: setQuestionID\n  } = useState(null);\n  const {\n    0: CheckSuccess,\n    1: setCheckSuccess\n  } = useState(false);\n  const {\n    0: numberQuestion,\n    1: setNumberQuestion\n  } = useState(0);\n  const number = new Array(numberQuestion); //=================================================\n  //style component ของ Progress-------------\n\n  const rotate = keyframes`\n    from {\n      width: 0%;\n    }\n  \n    to {\n      width: 100%;\n    }\n  `;\n  const Box = styled.div`\n    color: #fff !important;\n    background-color: #ec6900 !important;\n    height: 5px;\n    width: 100%;\n    animation: ${rotate} ${timer}s linear;\n  `; //-----------------------------------------\n\n  useEffect(() => {\n    if (!isLoading) {\n      Axios({\n        method: \"post\",\n        url: \"http://34.87.54.114:8003/api/v1/query/question\",\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"jwt\")}`\n        },\n        data: {\n          patient_no: \"3640600077526\",\n          form_question_id: 1\n        }\n      }).then(res => {\n        setPage(res.data.payload);\n        setNumberQuestion(page.length); //setisLoading(true);\n\n        settoken(true);\n        console.log(\"Import Data Success!\", res);\n      }).catch(error => {\n        console.log(\"Not found Token or PatientNo\", error.response.status);\n\n        if (error.response.status === 401) {\n          Axios({\n            method: \"GET\",\n            url: \"http://34.87.54.114:8003/api/v1/manage/token\",\n            headers: {\n              Authorization: `Bearer ${localStorage.getItem(\"jwt-refresh\")}`\n            }\n          }).then(res => {\n            localStorage.setItem(\"jwt\", res.data[\"accept-token\"]);\n            console.log(\"Update Token Success!\");\n            setisLoading(false);\n          }).catch(error => {\n            console.log(\"Error Code\", error.response.status);\n            Router.push(\"/page.covid1\");\n          });\n        }\n\n        if (error.response.status === 404) {\n          console.log(\"ไม่มีข้อมูลอยู่ในระบบ\");\n          Router.push(\"/page.covid2\");\n        }\n      });\n    }\n  }, []);\n  useEffect(() => {\n    if (token) {\n      console.log(\"สถานะการโหลดข้อมูล\", token);\n      console.log(\"isLoading =\", isLoading);\n      console.log(\"คำถามที่เท่าไร\", currentQuestion + 1);\n      console.log(\"คำถามทั้งหมด\", page);\n      settoken(false);\n      loadQuizData();\n    }\n\n    if (currentQuestion > 0) {\n      console.log(\"สถานะของ Token =\", token);\n      console.log(\"คำถามข้อปัจจุบัน\", page[currentQuestion]);\n      console.log(\"คำถามที่เท่าไร\", currentQuestion + 1);\n\n      if (currentQuestion !== currentQuestion - 1) {\n        setQuestion(page[currentQuestion].body);\n        setoptions(page[currentQuestion].voice);\n        setQuestionID(page[currentQuestion].questions_id);\n        setKeyword(page[currentQuestion].keywords);\n        setTimer(52);\n        console.log(\"QuestionID\", questionID);\n      }\n    }\n\n    if (!disabled) {\n      setdisabled(true);\n    } //setTimeout(()=>{alert('หมดเวลา');},timer*1000);\n\n  }, [token, currentQuestion]); //Function การจัดการคำถาม==============================\n\n  const loadQuizData = () => {\n    setdisabled(false);\n    setQuestion(page[currentQuestion].body);\n    setoptions(page[currentQuestion].voice);\n    setQuestionID(page[currentQuestion].questions_id);\n    setKeyword(page[currentQuestion].keywords);\n    setisLoading(true);\n    setShowResults(true);\n    console.log(\"Page have\", page);\n    console.log(\"QuestionID\", questionID);\n  };\n\n  const nextQuestionHandler = async (answer, raw_answer) => {\n    if (currentQuestion === page.length - 1) {\n      finishHandler(answer, raw_answer);\n    } else {\n      if (answer === true) {\n        setscore(score + 1);\n      } else {\n        setscore(score);\n      }\n\n      setQuestionNo([...questionNo, {\n        question_id: questionID,\n        answer: answer,\n        rew_answer: raw_answer\n      }]);\n      setCurrentQuestion(currentQuestion + 1);\n      console.log(\"Question\", currentQuestion, questionNo);\n    }\n  };\n\n  const finishHandler = (answer, raw_answer) => {\n    setAnswerQuestion([...answerQuestion, answer]);\n    setQuestionNo([...questionNo, {\n      question_id: questionID,\n      answer: answer,\n      rew_answer: raw_answer\n    }]);\n\n    if (answer === \"yes\") {\n      setscore(score + 1);\n    }\n\n    if (currentQuestion === page.length - 1) {\n      setisEnd(true);\n    }\n  };\n\n  const saveDataHandler = async () => {\n    setCheckSuccess(true);\n    console.log(\"เตรียม\", questionNo);\n    await Axios({\n      method: \"post\",\n      url: \"http://34.87.54.114:8003/api/v1/query/sendQuestion\",\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem(\"jwt\")}`\n      },\n      data: {\n        /*patient_no: SSID,\r\n        form_question_id: 1,\r\n        form_question: questionNo*/\n        patient_no: 1103702303712,\n        form_questions_id: 2,\n        form_questions: [{\n          question_id: 4,\n          answer: true,\n          rew_answer: \"ไม่มีอาการ\"\n        }, {\n          question_id: 5,\n          answer: true,\n          rew_answer: \"ไม่มีอาการ\"\n        }, {\n          question_id: 6,\n          answer: true,\n          rew_answer: \"ไม่มีอาการ\"\n        }, {\n          question_id: 7,\n          answer: true,\n          rew_answer: \"ไม่มีอาการ\"\n        }]\n      }\n    }).then(function (res) {\n      console.log(\"Success to Save Data!\", res);\n      console.log(\"เตรียม\", questionNo);\n      Router.push(\"/page.covidcomplete\");\n    }).catch(error => {\n      console.log(\"Not found Token or PatientNo\", error.response.status);\n\n      if (error.response.status === 401) {\n        Axios({\n          method: \"GET\",\n          url: \"http://34.87.54.114:8003/api/v1/manage/token\",\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem(\"jwt-refresh\")}`\n          }\n        }).then(res => {\n          localStorage.setItem(\"jwt\", res.data[\"accept-token\"]);\n          console.log(\"Update Token Success!\");\n          setisLoading(false);\n        }).catch(error => {\n          console.log(\"Error Code\", error.response.status);\n          Router.push(\"/page.covid1\");\n        });\n      }\n\n      if (error.response.status === 404) {\n        console.log(\"ไม่มีข้อมูลอยู่ในระบบ\");\n        Router.push(\"/page.covid2\");\n      }\n    });\n  }; //====================================================\n\n\n  if (isLoading) {\n    if (isEnd) {\n      if (!CheckSuccess) {\n        saveDataHandler();\n      }\n\n      return null;\n    } else {\n      return __jsx(FormItem, null, __jsx(\"div\", {\n        className: \"nu-font-covid\"\n      }, __jsx(\"div\", {\n        className: \"nu-flex-column-fs\"\n      }, __jsx(\"div\", null, __jsx(HeaderCovid, {\n        link: \"/page.covid4\"\n      })), __jsx(\"div\", {\n        className: \"nu-flex-row-bsauto-h100\"\n      }, __jsx(\"div\", {\n        className: \"nu-fs10-covidqt\"\n      }, __jsx(\"div\", null, __jsx(_Button, {\n        shape: \"circle\"\n      }, \"<\"))), __jsx(\"div\", {\n        className: \"nu-flex-column-bsauto-w100 nu-center-covidss nu-h100-covidqt\"\n      }, __jsx(\"div\", {\n        className: \"nu-dp-name-covidqt\"\n      }, __jsx(QuestionCovid, {\n        text: question,\n        check: token\n      })), __jsx(\"div\", {\n        className: \"nu-center-covidss nu-dp-btn-covidqt\"\n      }, __jsx(ButtonQuestion, {\n        click: nextQuestionHandler,\n        question: question\n      }))), __jsx(\"div\", {\n        className: \"nu-fs10-covidqt\"\n      }, __jsx(\"div\", {\n        style: {\n          textAlign: \"right\"\n        }\n      }, __jsx(_Button, {\n        shape: \"circle\"\n      }, \">\")))), __jsx(\"div\", {\n        className: \"nu-dp-ud-covidqt\"\n      }, __jsx(\"div\", {\n        className: \"nu-dp-pgnt-covidqt\"\n      }, __jsx(\"div\", {\n        className: \"nu-pgnt-covidqt\"\n      }, __jsx(\"div\", {\n        className: \"nu-box-covid1\",\n        style: {\n          marginLeft: \"8%\"\n        }\n      }, page.map((page, index) => {\n        if (index === currentQuestion) {\n          return __jsx(\"span\", {\n            className: \"nu-box1-covid1\",\n            style: {\n              background: \"white\"\n            }\n          });\n        }\n\n        return __jsx(\"span\", {\n          className: \"nu-box1-covid1\"\n        });\n      })))), __jsx(\"div\", null, __jsx(AudioPlayer, {\n        url: options,\n        token: localStorage.getItem(\"jwt\"),\n        isLoading: isLoading\n      }))), __jsx(\"div\", {\n        className: \"nu-dptm-covidqt\"\n      }, __jsx(\"h5\", {\n        className: \"nu-h5-covidqt\"\n      }, __jsx(Duration, {\n        seconds: time\n      }))), __jsx(\"div\", null, __jsx(\"div\", {\n        className: \"w3-light-grey\"\n      }, __jsx(Box, null))), __jsx(\"div\", {\n        className: \"nu-dp-ud-covidqt\",\n        style: {\n          flexBasis: \"180px\"\n        }\n      }, __jsx(\"div\", {\n        className: \"nu-dp-pgnt-covidqt\"\n      }, __jsx(\"div\", {\n        className: \"sound-icon disabled\",\n        style: {\n          marginLeft: \"10%\"\n        }\n      }, __jsx(\"div\", {\n        className: \"sound-wave\"\n      }, __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      }), __jsx(\"i\", {\n        className: \"bar\"\n      })))), __jsx(\"div\", {\n        style: {\n          height: \"100%\",\n          marginTop: \"20px\"\n        }\n      }, __jsx(Speechtotext, {\n        speech: nextQuestionHandler,\n        keyword: keyword,\n        page: \"covidquestion\"\n      }))), __jsx(\"div\", {\n        className: \"nu-flex-btn-covid1\"\n      }, __jsx(Copyright, null)))));\n    }\n  } else {\n    return null;\n  }\n}\n\nexport default CovidQuestion;","map":null,"metadata":{},"sourceType":"module"}