{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nvar __jsx = React.createElement;\nimport { LeftOutlined, RightOutlined } from \"@ant-design/icons\";\nimport Router from \"next/router\";\nimport React, { useState, useEffect } from \"react\";\nimport HeaderCovid from \"./components/component.headercovid\";\nimport QuestionCovid from \"./components/component.question\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport Axios from \"axios\";\nimport AudioPlayer from \"./components/component.audioplayer\";\nimport Duration from \"./components/component.duration\";\nimport Speechtotext from \"./components/component.speechtotext\";\nimport Copyright from \"./components/component.footercopyright\";\nimport ButtonQuestion from \"./components/component.buttonquestion\";\nimport ReactPlayer from \"react-player\";\nimport AudioAsk from '../public/SoundSuggestAsk.mp3';\nvar Array = [];\nvar mytimeout;\nvar mytimestart;\nvar form_questionid;\nvar FormItem = _Form.Item;\n\nfunction CovidQuestion() {\n  //State จัดการเรื่องชุดคำถาม =========================\n  var _useState = useState([]),\n      page = _useState[0],\n      setPage = _useState[1];\n\n  var _useState2 = useState(0),\n      currentQuestion = _useState2[0],\n      setCurrentQuestion = _useState2[1];\n\n  var _useState3 = useState(false),\n      isEnd = _useState3[0],\n      setisEnd = _useState3[1];\n\n  var _useState4 = useState(false),\n      isLoading = _useState4[0],\n      setisLoading = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      options = _useState5[0],\n      setoptions = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      question = _useState6[0],\n      setQuestion = _useState6[1];\n\n  var _useState7 = useState(false),\n      token = _useState7[0],\n      settoken = _useState7[1];\n\n  var _useState8 = useState([]),\n      keyword = _useState8[0],\n      setKeyword = _useState8[1];\n\n  var _useSelector = useSelector(function (state) {\n    return state.post;\n  }),\n      time = _useSelector.time; //จัดการชุดคำตอบที่จะส่งไปตอนเสร็จ\n\n\n  var _useState9 = useState(null),\n      questionID = _useState9[0],\n      setQuestionID = _useState9[1];\n\n  var _useState10 = useState(false),\n      CheckSuccess = _useState10[0],\n      setCheckSuccess = _useState10[1];\n\n  var _useState11 = useState(false),\n      checkAudio = _useState11[0],\n      setcheckAudio = _useState11[1];\n\n  var dispatch = useDispatch(); //=================================================\n  //-----------------------------------------\n\n  useEffect(function () {\n    if (!isLoading) {\n      Axios({\n        method: \"post\",\n        url: \"https://www.nuscreening.kasemsanm.com/api/v1/query/question\",\n        headers: {\n          Authorization: \"Bearer \".concat(localStorage.getItem(\"jwt\"))\n        },\n        data: {\n          patient_no: \"3640600077526\",\n          form_question_id: 1\n        }\n      }).then(function (res) {\n        console.log(\"Import Data Success!\", res); //Array[res.data.payload.length-1] = undefined\n\n        form_questionid = 1;\n        setTimeout(function () {\n          setPage(res.data.payload);\n          settoken(true);\n        }, 28000);\n      })[\"catch\"](function (error) {\n        console.log(\"Not found Token or PatientNo\", error.response.status);\n\n        if (error.response.status === 401) {\n          Axios({\n            method: \"GET\",\n            url: \"https://www.nuscreening.kasemsanm.com/api/v1/manage/token\",\n            headers: {\n              Authorization: \"Bearer \".concat(localStorage.getItem(\"jwt-refresh\"))\n            }\n          }).then(function (res) {\n            localStorage.setItem(\"jwt\", res.data[\"accessToken\"]);\n            localStorage.setItem(\"jwt-refresh\", res.data[\"refreshToken\"]);\n            console.log(\"Update Token Success!\");\n          })[\"catch\"](function (error) {\n            console.log(\"Error Code\", error.response.status);\n            Router.push(\"/page.covid1\");\n          });\n        }\n\n        if (error.response.status === 404) {\n          console.log(\"ไม่มีข้อมูลอยู่ในระบบ\");\n          Router.push(\"/page.covid2\");\n        }\n      });\n    }\n  }, []);\n  useEffect(function () {\n    if (token) {\n      console.log(\"Function Set Question Two!\", page.length, currentQuestion);\n\n      if (Array.length >= page.length) {\n        for (var i = 0; i <= Array.length - 1; i++) {\n          if (Array[i] === undefined) {\n            console.log(\"break\", Array[i], Array.length, i);\n            break;\n          }\n\n          console.log(\"err\", i + 1, Array.length);\n\n          if (i === Array.length - 1) {\n            console.log(\"Check Complete And Go to savedata!\");\n            setisEnd(true);\n          }\n        } //console.log(\"หลุดลูป\");\n\n      }\n\n      if (page.length - 1 >= currentQuestion >= 0) {\n        //console.log(\"CurrentQuestion in set question!\", currentQuestion);\n        setQuestion(page[currentQuestion].body);\n        setoptions(page[currentQuestion].voice);\n        setQuestionID(page[currentQuestion].question_id);\n        setKeyword(page[currentQuestion].keywords);\n        settoken(false);\n        setisLoading(true);\n        mytimeout = setTimeout(function () {\n          alert(\"TimeOut!\");\n        }, [20500]);\n      }\n    }\n  }, [token, currentQuestion]);\n  useEffect(function () {\n    console.log(time * 1000, \"time\");\n    console.log(\"Time!\", options.duration);\n  }, [time]);\n\n  var nextQuestionHandler = function nextQuestionHandler(answer, raw_answer) {\n    setcheckAudio(false);\n    clearTimeout(mytimeout);\n    Array[currentQuestion] = {\n      question_id: questionID,\n      answer: answer,\n      rew_answer: raw_answer\n    };\n\n    if (currentQuestion + 1 >= page.length) {\n      //console.log(\"Final1111\", currentQuestion + 1);\n      setCurrentQuestion(currentQuestion);\n      settoken(true);\n    } else {\n      setCurrentQuestion(currentQuestion + 1);\n      settoken(true); //console.log(\"Final3333\", currentQuestion + 1);\n    } //console.log(\"Question\", currentQuestion);\n\n\n    console.log(\"Array\", Array);\n    setisLoading(false); //}\n  };\n\n  var saveDataHandler = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var cid, payload;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              cid = JSON.parse(localStorage.getItem(\"user\"));\n              payload = {\n                patient_no: cid.cid,\n                form_questions_id: form_questionid,\n                form_questions: Array\n              };\n              console.log(\"Data ready to send backend!\", payload);\n              setCheckSuccess(true);\n              _context.next = 6;\n              return Axios({\n                method: \"post\",\n                url: \"https://www.nuscreening.kasemsanm.com/api/v1/query/sendQuestion\",\n                headers: {\n                  Authorization: \"Bearer \".concat(localStorage.getItem(\"jwt\"))\n                },\n                data: payload\n              }).then(function (res) {\n                console.log(\"Success to Save Data!\", res);\n                var checknextform = res.data.payload;\n                console.log(\"SSSS\", res.data.payload);\n\n                if (checknextform === undefined || checknextform === null) {\n                  Array = [];\n                  console.log(\"จบโปเสด\");\n                  Router.push(\"/page.covidcomplete\");\n                } else {\n                  Array = [];\n                  console.log(\"Restart Array!\", Array);\n                  console.log(\"Restart Data!\", res.data);\n                  form_questionid = res.data.payload[0].form_question_id;\n                  console.log(form_questionid);\n                  setisLoading(false);\n                  setisEnd(false);\n                  setCurrentQuestion(0);\n                  setPage(res.data.payload);\n                  settoken(true);\n                  setCheckSuccess(false);\n                }\n              })[\"catch\"](function (error) {\n                console.log(\"Not found Token or PatientNo\", error);\n\n                if (error.response.status === 401) {\n                  Axios({\n                    method: \"GET\",\n                    url: \"https://www.nuscreening.kasemsanm.com/api/v1/manage/token\",\n                    headers: {\n                      Authorization: \"Bearer \".concat(localStorage.getItem(\"jwt-refresh\"))\n                    }\n                  }).then(function (res) {\n                    localStorage.setItem(\"jwt\", res.data[\"accessToken\"]);\n                    localStorage.setItem(\"jwt-refresh\", res.data[\"refreshToken\"]);\n                    console.log(\"Update Token Success!\");\n                    setisLoading(false);\n                  })[\"catch\"](function (error) {\n                    console.log(\"Error Code\", error.response.status);\n                    Router.push(\"/page.covid1\");\n                  });\n                }\n\n                if (error.response.status === 404) {\n                  console.log(\"ไม่มีข้อมูลอยู่ในระบบ\");\n                  Router.push(\"/page.covid2\");\n                }\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function saveDataHandler() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var ButtonNext = function ButtonNext(condition) {\n    setcheckAudio(false);\n    clearTimeout(mytimeout);\n\n    if (\"next\" === condition) {\n      if (currentQuestion + 1 >= page.length) {\n        //console.log(\"Final Question\", currentQuestion, page.length);\n        setCurrentQuestion(currentQuestion);\n        settoken(true);\n        setisLoading(false);\n      } else {\n        //console.log(\"Simple Question\", currentQuestion, page.length);\n        setCurrentQuestion(currentQuestion + 1);\n        settoken(true);\n        setisLoading(false);\n      }\n    } else if (\"back\" === condition) {\n      if (currentQuestion === 0) {\n        //console.log(\"First Question\", currentQuestion, page.length);\n        setCurrentQuestion(currentQuestion);\n        settoken(true);\n        setisLoading(false);\n      } else {\n        //console.log(\"Simple Question\", currentQuestion, page.length);\n        setCurrentQuestion(currentQuestion - 1);\n        settoken(true);\n        setisLoading(false);\n      }\n    }\n\n    console.log(\"Array\", Array);\n  };\n\n  var Showbar = function Showbar() {\n    return __jsx(\"div\", {\n      className: \"w3-light-grey\"\n    }, __jsx(\"div\", {\n      className: \"nu-boxbar-covidqt\"\n    }));\n  };\n\n  var handleDuration = function handleDuration(duration) {\n    //dispatch(updateTime(duration));\n    mytimestart = duration;\n    setcheckAudio(true);\n  }; //====================================================\n\n\n  if (isLoading) {\n    if (isEnd) {\n      clearTimeout(mytimeout);\n\n      if (!CheckSuccess) {\n        saveDataHandler();\n      }\n\n      return null;\n    } else {\n      console.log(\"Re-Render1\");\n\n      if (checkAudio) {\n        console.log(\"Re-Render2\");\n        return __jsx(FormItem, null, __jsx(\"div\", {\n          className: \"nu-font-covid\"\n        }, __jsx(\"div\", {\n          className: \"nu-flex-column-fs\"\n        }, __jsx(\"div\", null, __jsx(HeaderCovid, {\n          link: \"/page.covid4\"\n        })), __jsx(\"div\", {\n          className: \"nu-flex-row-bsauto-h100\"\n        }, __jsx(\"div\", {\n          className: \"nu-fs10-covidqt nu-flexleft-covid\"\n        }, __jsx(_Button, {\n          shape: \"circle\",\n          size: \"middle\",\n          className: \"nu-btn-left-covidqt\",\n          onClick: function onClick() {\n            return ButtonNext(\"back\");\n          }\n        }, __jsx(LeftOutlined, {\n          style: {\n            fontSize: \"35px\"\n          }\n        }))), __jsx(\"div\", {\n          className: \"nu-flex-column-bsauto-w100 nu-center-covidss nu-h100-covidqt\"\n        }, __jsx(\"div\", {\n          className: \"nu-dp-name-covidqt\"\n        }, __jsx(QuestionCovid, {\n          text: question,\n          check: token\n        })), __jsx(\"div\", {\n          className: \"nu-center-covidss nu-dp-btn-covidqt\"\n        }, __jsx(ButtonQuestion, {\n          click: nextQuestionHandler,\n          question: question,\n          check: Array[currentQuestion]\n        }))), __jsx(\"div\", {\n          className: \"nu-fs10-covidqt nu-flexright-covid\"\n        }, __jsx(_Button, {\n          shape: \"circle\",\n          size: \"middle\",\n          className: \"nu-btn-right-covidqt\",\n          onClick: function onClick() {\n            return ButtonNext(\"next\");\n          }\n        }, __jsx(RightOutlined, {\n          style: {\n            fontSize: \"35px\"\n          }\n        })))), __jsx(\"div\", {\n          className: \"nu-dp-ud-covidqt\"\n        }, __jsx(\"div\", {\n          className: \"nu-dp-pgnt-covidqt\"\n        }, __jsx(\"div\", {\n          className: \"nu-pgnt-covidqt\"\n        }, __jsx(\"div\", {\n          className: \"nu-box-covid1\",\n          style: {\n            marginLeft: \"70px\"\n          }\n        }, page.map(function (page, index) {\n          if (index === currentQuestion) {\n            return __jsx(\"span\", {\n              className: \"nu-box1-covid1\",\n              style: {\n                background: \"white\"\n              }\n            });\n          }\n\n          return __jsx(\"span\", {\n            className: \"nu-box1-covid1\"\n          });\n        })))), __jsx(\"div\", null, __jsx(AudioPlayer, {\n          url: options,\n          token: localStorage.getItem(\"jwt\"),\n          isLoading: isLoading\n        }))), __jsx(\"div\", {\n          className: \"nu-dptm-covidqt\"\n        }, __jsx(\"h5\", {\n          className: \"nu-h5-covidqt\"\n        }, __jsx(Duration, {\n          seconds: mytimestart\n        }))), __jsx(\"div\", null, __jsx(Showbar, {\n          text: question\n        })), __jsx(\"div\", {\n          className: \"nu-dp-ud-covidqt\",\n          style: {\n            flexBasis: \"180px\"\n          }\n        }, __jsx(\"div\", {\n          className: \"nu-dp-pgnt-covidqt\"\n        }, __jsx(\"div\", {\n          className: \"sound-icon disabled\",\n          style: {\n            marginLeft: \"80px\"\n          }\n        }, __jsx(\"div\", {\n          className: \"sound-wave\"\n        }, __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        }), __jsx(\"i\", {\n          className: \"bar\"\n        })))), __jsx(\"div\", {\n          style: {\n            height: \"100%\",\n            marginTop: \"20px\"\n          }\n        }, __jsx(Speechtotext, {\n          speech: nextQuestionHandler,\n          keyword: keyword,\n          page: \"covidquestion\",\n          time: mytimestart,\n          formquestionid: form_questionid\n        }))), __jsx(\"div\", {\n          className: \"nu-flex-btn-covid1\"\n        }, __jsx(Copyright, null)))));\n      } else {\n        console.log('Re-Render3');\n        return __jsx(\"div\", null, __jsx(ReactPlayer, {\n          controls: true,\n          light: false,\n          playing: false,\n          width: \"0%\",\n          height: \"0%\",\n          url: options,\n          onDuration: handleDuration\n        }));\n      }\n    }\n  } else {\n    return __jsx(FormItem, null, __jsx(\"div\", {\n      className: \"nu-font-covid\"\n    }, __jsx(\"div\", {\n      className: \"nu-flex-column-fs\"\n    }, __jsx(\"div\", null, __jsx(HeaderCovid, {\n      link: \"/page.covid4\"\n    })), __jsx(\"div\", {\n      className: \"nu-flex-row-bsauto-h100\",\n      style: {\n        padding: \"200px\"\n      }\n    }, __jsx(\"div\", {\n      style: {\n        background: \"#FFFFFF0A 0% 0% no-repeat padding-box\",\n        width: \"100%\",\n        borderRadius: \"35px\",\n        padding: \"20px\",\n        textAlign: \"center\"\n      }\n    }, __jsx(\"h1\", {\n      style: {\n        fontSize: \"50px\"\n      }\n    }, \"\\u0E04\\u0E33\\u0E41\\u0E19\\u0E30\\u0E19\\u0E33\"), __jsx(\"h2\", {\n      style: {\n        fontSize: \"25px\"\n      }\n    }, \"\\u0E01\\u0E23\\u0E38\\u0E13\\u0E32\\u0E1F\\u0E31\\u0E07\\u0E40\\u0E2A\\u0E35\\u0E22\\u0E07\\u0E04\\u0E33\\u0E16\\u0E32\\u0E21\\u0E43\\u0E2B\\u0E49\\u0E08\\u0E1A\\u0E01\\u0E48\\u0E2D\\u0E19 \\u0E41\\u0E25\\u0E49\\u0E27\\u0E08\\u0E30\\u0E21\\u0E35\\u0E40\\u0E2A\\u0E35\\u0E22\\u0E07\\u0E41\\u0E08\\u0E49\\u0E07\\u0E40\\u0E15\\u0E37\\u0E2D\\u0E19\\u0E40\\u0E1E\\u0E37\\u0E48\\u0E2D\\u0E1A\\u0E2D\\u0E01\\u0E27\\u0E48\\u0E32 \\u0E01\\u0E32\\u0E23\\u0E1A\\u0E31\\u0E19\\u0E17\\u0E36\\u0E01\\u0E40\\u0E2A\\u0E35\\u0E22\\u0E07\\u0E1E\\u0E23\\u0E49\\u0E2D\\u0E21\\u0E43\\u0E0A\\u0E49\\u0E07\\u0E32\\u0E19\\u0E41\\u0E25\\u0E49\\u0E27 \\u0E2B\\u0E25\\u0E31\\u0E07\\u0E08\\u0E32\\u0E01\\u0E19\\u0E31\\u0E49\\u0E19\\u0E43\\u0E2B\\u0E49\\u0E04\\u0E38\\u0E13\\u0E2A\\u0E32\\u0E21\\u0E32\\u0E23\\u0E16\\u0E15\\u0E2D\\u0E1A\\u0E41\\u0E1A\\u0E1A\\u0E1F\\u0E2D\\u0E23\\u0E4C\\u0E21\\u0E42\\u0E14\\u0E22\\u0E1E\\u0E39\\u0E14\\u0E27\\u0E48\\u0E32 \\u0E43\\u0E0A\\u0E48 \\u0E2B\\u0E23\\u0E37\\u0E2D \\u0E44\\u0E21\\u0E48\\u0E43\\u0E0A\\u0E48 \\u0E01\\u0E32\\u0E23\\u0E15\\u0E2D\\u0E1A\\u0E04\\u0E33\\u0E16\\u0E32\\u0E21\\u0E17\\u0E35\\u0E48\\u0E14\\u0E35\\u0E04\\u0E37\\u0E2D\\u0E40\\u0E19\\u0E49\\u0E19\\u0E15\\u0E2D\\u0E1A\\u0E43\\u0E2B\\u0E49\\u0E0A\\u0E31\\u0E14\\u0E40\\u0E08\\u0E19 \\u0E41\\u0E25\\u0E30\\u0E16\\u0E49\\u0E32\\u0E22\\u0E34\\u0E48\\u0E07\\u0E15\\u0E2D\\u0E1A\\u0E41\\u0E04\\u0E48\\u0E27\\u0E48\\u0E32 \\u0E43\\u0E0A\\u0E48 \\u0E2B\\u0E23\\u0E37\\u0E2D \\u0E44\\u0E21\\u0E48\\u0E43\\u0E0A\\u0E48 \\u0E08\\u0E30\\u0E14\\u0E35\\u0E17\\u0E35\\u0E48\\u0E2A\\u0E38\\u0E14\\u0E15\\u0E48\\u0E2D\\u0E01\\u0E32\\u0E23\\u0E1B\\u0E23\\u0E30\\u0E21\\u0E27\\u0E25\\u0E1C\\u0E25\")), __jsx(ReactPlayer, {\n      url: AudioAsk,\n      playing: true,\n      width: \"0%\",\n      height: \"0%\"\n    })), __jsx(\"div\", {\n      className: \"nu-flex-btn-covid1\"\n    }, __jsx(Copyright, null)))));\n  }\n}\n\nexport default CovidQuestion;","map":null,"metadata":{},"sourceType":"module"}